<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.450">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>gdalcubes – collection_formats</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<link href="../../favicon.png" rel="icon" type="image/png">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


<link rel="stylesheet" href="../../styles.css">
</head>

<body class="nav-sidebar floating nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a href="../../index.html" class="navbar-brand navbar-brand-logo">
    <img src="../../source/gdalcubes_logo_mini.png" alt="" class="navbar-logo">
    </a>
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">gdalcubes</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../source/getstarted.html" rel="" target="">
 <span class="menu-text">Get started</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link active" href="../../source/introduction/why.html" rel="" target="" aria-current="page">
 <span class="menu-text">Overview</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../source/tutorials/index.html" rel="" target="">
 <span class="menu-text">Tutorials</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../source/reference/index.html" rel="" target="">
 <span class="menu-text">Reference</span></a>
  </li>  
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-help" role="button" data-bs-toggle="dropdown" aria-expanded="false" rel="" target="">
 <span class="menu-text">Help</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-help">    
        <li>
    <a class="dropdown-item" href="https://github.com/appelmar/gdalcubes_R" rel="" target=""><i class="bi bi-github" role="img">
</i> 
 <span class="dropdown-text">Source code</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="https://github.com/appelmar/gdalcubes_R/issues" rel="" target=""><i class="bi bi-bug" role="img">
</i> 
 <span class="dropdown-text">Report an issue</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../source/introduction/faq.html" rel="" target=""><i class="bi bi-question-circle" role="img">
</i> 
 <span class="dropdown-text">FAQ</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item">
    <a class="nav-link" href="../../source/about.html" rel="" target="">
 <span class="menu-text">About</span></a>
  </li>  
</ul>
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/appelmar/gdalcubes_R" rel="" target=""><i class="bi bi-github" role="img">
</i> 
 <span class="menu-text"></span></a>
  </li>  
</ul>
            <div class="quarto-navbar-tools">
</div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
      <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../../source/concepts/image_collections.html">Basic concepts</a></li><li class="breadcrumb-item"><a href="../../source/concepts/collection_formats.html">Image collection formats</a></li></ol></nav>
      <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
      </a>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal sidebar-navigation floating overflow-auto">
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true">
 <span class="menu-text">Overview</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../source/introduction/why.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Why gdalcubes?</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../source/introduction/components.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Components</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../source/introduction/installation.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Installation</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../source/introduction/faq.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">FAQ</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../source/introduction/license.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">License</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../source/introduction/credits.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Credits</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true">
 <span class="menu-text">Basic concepts</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../source/concepts/image_collections.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Image collections</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../source/concepts/collection_formats.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text">Image collection formats</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../source/concepts/datacubes.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Data cubes</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../source/concepts/operations.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Data cube operations</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../source/concepts/execution.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Execution and parallelization</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../source/concepts/udfs.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">User-defined functions (UDFs)</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../source/concepts/config.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Configuration options</span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#image-collection-formats" id="toc-image-collection-formats" class="nav-link active" data-scroll-target="#image-collection-formats">Image collection formats</a>
  <ul class="collapse">
  <li><a href="#regular-expressions" id="toc-regular-expressions" class="nav-link" data-scroll-target="#regular-expressions">Regular expressions</a></li>
  <li><a href="#json-format" id="toc-json-format" class="nav-link" data-scroll-target="#json-format">JSON format</a>
  <ul class="collapse">
  <li><a href="#header-information" id="toc-header-information" class="nav-link" data-scroll-target="#header-information">Header information</a></li>
  <li><a href="#global-dataset-pattern" id="toc-global-dataset-pattern" class="nav-link" data-scroll-target="#global-dataset-pattern">Global dataset pattern</a></li>
  <li><a href="#grouping-datasets-by-image-names" id="toc-grouping-datasets-by-image-names" class="nav-link" data-scroll-target="#grouping-datasets-by-image-names">Grouping datasets by image names</a></li>
  <li><a href="#extracting-datetime-information" id="toc-extracting-datetime-information" class="nav-link" data-scroll-target="#extracting-datetime-information">Extracting date/time information</a></li>
  <li><a href="#defining-bands" id="toc-defining-bands" class="nav-link" data-scroll-target="#defining-bands">Defining bands</a></li>
  <li><a href="#reading-gdal-subdatasets" id="toc-reading-gdal-subdatasets" class="nav-link" data-scroll-target="#reading-gdal-subdatasets">Reading GDAL subdatasets</a></li>
  <li><a href="#defining-a-global-spatial-reference-system" id="toc-defining-a-global-spatial-reference-system" class="nav-link" data-scroll-target="#defining-a-global-spatial-reference-system">Defining a global spatial reference system</a></li>
  <li><a href="#additional-image-metadata" id="toc-additional-image-metadata" class="nav-link" data-scroll-target="#additional-image-metadata">Additional image metadata</a></li>
  </ul></li>
  <li><a href="#complete-examples" id="toc-complete-examples" class="nav-link" data-scroll-target="#complete-examples">Complete examples</a></li>
  <li><a href="#notes-on-writing-custom-collection-formats" id="toc-notes-on-writing-custom-collection-formats" class="nav-link" data-scroll-target="#notes-on-writing-custom-collection-formats">Notes on writing custom collection formats</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content"><div class="quarto-title-block"><div class="quarto-title-tools-only"><h1></h1><button type="button" class="btn code-tools-button" id="quarto-code-tools-source"><i class="bi"></i> Code</button></div></div>



<section id="image-collection-formats" class="level1">
<h1>Image collection formats</h1>
<p>Image collection formats describe how image collections are composed from GDAL datasets, considering specific data product organizations.</p>
<p>A collection format is a JSON file defining rules, how to derive required metadata when a GDAL dataset (specified by its identifier, e.g.&nbsp;the path to a local GeoTIFF file) is added to an image collection.</p>
<p>When adding a GDAL dataset (given its identifier) to a collection, we must find out</p>
<ul>
<li>to which image the dataset belongs (identified by a unique image name),</li>
<li>the recording date/time of the dataset, and</li>
<li>how bands of the dataset relate to bands of the collection.</li>
</ul>
<section id="regular-expressions" class="level2">
<h2 class="anchored" data-anchor-id="regular-expressions">Regular expressions</h2>
<p>Rules are mostly defined as regular expresions on the GDAL dataset identifiers. Some expressions simply check whether a dataset <em>matches</em> the expression or not, whereas some expression return a captured substring (e.g.&nbsp;the datetime part). gdalcubes uses the <a href="http://www.cplusplus.com/reference/regex">standard C++11 regular expression library</a> with default <a href="http://www.cplusplus.com/reference/regex/ECMAScript">ECMAScript</a> syntax.</p>
</section>
<section id="json-format" class="level2">
<h2 class="anchored" data-anchor-id="json-format">JSON format</h2>
<section id="header-information" class="level3">
<h3 class="anchored" data-anchor-id="header-information">Header information</h3>
<p>The JSON files for image collection formats start with some header information, including a short description of the particular product it adresses and some keywords. These header information are optional, but may be useful for searching.</p>
<p>For example, the following description and tags are used in the collection format for Sentinel 2 Level 2A products.</p>
<pre><code>{
    "description" : "Image collection format for Sentinel 2 Level 2A data as downloaded from the Copernicus Open Access Hub, expects a list of file paths as input. The format should work on original ZIP compressed as well as uncompressed imagery.",
    "tags" : ["Sentinel", "Copernicus", "ESA", "BOA", "Surface Reflectance"]
}</code></pre>
</section>
<section id="global-dataset-pattern" class="level3">
<h3 class="anchored" data-anchor-id="global-dataset-pattern">Global dataset pattern</h3>
<p>Collection formats include a global pattern as a regular expression such that input GDAL datasets not matching the regular expression will simply be ignored (quietly, without throwing exceptions). As a simple example, setting <code>"pattern" : ".*\\.tif$"</code> would ignore files that do not end with “.tif”.</p>
</section>
<section id="grouping-datasets-by-image-names" class="level3">
<h3 class="anchored" data-anchor-id="grouping-datasets-by-image-names">Grouping datasets by image names</h3>
<p>Images can be composed from one or more GDAL datasets, where all datasets share the spatial extent, the spatial reference system, and acquisition date/time, but different datasets contain data for different bands.</p>
<p>gdalcubes uses a regular expression to extract an <em>image name</em> from the GDAL dataset identifier. The extracted name must be identical for all datasets belonging to the same image.</p>
<p>To extract the image name from the identifier, the first <em>marked subexpression</em> (or <em>capturing group</em>) of the provided regular expression under <code>"images" : {"pattern": "REGEX"}</code> is used, i.e., a part in the expression within the first pair of parentheses.</p>
<hr>
<section id="example-1-landsat-8-surface-reflectance" class="level4">
<h4 class="anchored" data-anchor-id="example-1-landsat-8-surface-reflectance">Example 1 (Landsat 8 surface reflectance)</h4>
<pre><code>{"images":{"pattern":".*(L[OTC]08_.{4}_.{6}_.{8}_.{8}_.{2}_.{2})[A-Za-z0-9_]+\\.tif"}}</code></pre>
<p>Example input GDAL dataset identifiers and extracted <strong>image name</strong> (bold):</p>
<pre>1. /path/to/<b>LC08_L1TP_226063_20140719_20170421_01_T1</b>_sr_band2.tif
2. /path/to/<b>LC08_L1TP_226063_20140820_20170420_01_T1</b>_sr_aerosol.tif
3. /path/to/<b>LC08_L1TP_227064_20130621_20170503_01_T1</b>_pixel_qa.tif
</pre>
<hr>
</section>
<section id="example-2-modis-mod13a2" class="level4">
<h4 class="anchored" data-anchor-id="example-2-modis-mod13a2">Example 2 (MODIS MOD13A2)</h4>
<pre><code>{"images":{"pattern":"HDF4_EOS:EOS_GRID:\".+(MOD13A2\\.A.+)\\.hdf.*"}}</code></pre>
<p>Example input GDAL dataset identifiers and extracted <strong>image name</strong> (bold):</p>
<pre>1. HDF4_EOS:EOS_GRID:"/path/to/<b>MOD13A2.A2013353.h00v08.006.2018226105756</b>.hdf":MODIS_Grid_16DAY_1km_VI:1 km 16 days NDVI
2. HDF4_EOS:EOS_GRID:"/path/to/<b>MOD13A2.A2013353.h20v03.006.2018226105924</b>.hdf":MODIS_Grid_16DAY_1km_VI:1 km 16 days NDVI 
3. HDF4_EOS:EOS_GRID:"/path/to/<b>MOD13A2.A2015033.h23v10.006.2015296122819</b>.hdf":MODIS_Grid_16DAY_1km_VI:1 km 16 days VI Quality
</pre>
<hr>
</section>
</section>
<section id="extracting-datetime-information" class="level3">
<h3 class="anchored" data-anchor-id="extracting-datetime-information">Extracting date/time information</h3>
<p>In the current version of gdalcubes, the acquisition date/time of images is derived from the dataset identifiers. Similar to the extraction of image names, a pattern defines a regular expression where the first marked subexpression / capturing group within parentheses is extracted. The <code>format</code> field in <code>datetime</code> JSON object then defines how to convert the extracted string to a date/time object, according to the <a href="https://pubs.opengroup.org/onlinepubs/9699919799/functions/strptime.html">strptime function</a>.</p>
<hr>
<section id="example-1-sentinel-2-level-2a-safe-format-from-.zip-files" class="level4">
<h4 class="anchored" data-anchor-id="example-1-sentinel-2-level-2a-safe-format-from-.zip-files">Example 1 (Sentinel 2 Level 2A SAFE format, from .zip files)</h4>
<pre><code>{
   "datetime" : {
       "pattern" : ".*MSIL2A_(.+?)_.*\\.zip.*",
       "format" : "%Y%m%dT%H%M%S"}  
} </code></pre>
<p>Example input GDAL dataset identifiers and extracted <strong>date/time string</strong> (bold):</p>
<pre>1. /vsizip//path/to/S2A_MSIL2A_<b>20180328T093031</b>_N0207_R136_T34UFD_20180328T145945.zip/S2A_MSIL2A_20180328T093031_N0207_R136_T34UFD_20180328T145945.SAFE/GRANULE/L2A_T34UFD_A014433_20180328T093032/IMG_DATA/R20m/T34UFD_20180328T093031_B8A_20m.jp2"
2. /vsizip//path/to/S2A_MSIL2A_<b>20180328T093031</b>_N0207_R136_T34UFD_20180328T145945.zip/S2A_MSIL2A_20180328T093031_N0207_R136_T34UFD_20180328T145945.SAFE/GRANULE/L2A_T34UFD_A014433_20180328T093032/IMG_DATA/R20m/T34UFD_20180328T093031_SCL_20m.jp2
3. /vsizip//path/to/S2A_MSIL2A_<b>20180430T094031</b>_N0207_R036_T34UGD_20180430T114456.zip/S2A_MSIL2A_20180430T094031_N0207_R036_T34UGD_20180430T114456.SAFE/GRANULE/L2A_T34UGD_A014905_20180430T094109/IMG_DATA/R10m/T34UGD_20180430T094031_B08_10m.jp2
</pre>
<hr>
</section>
<section id="example-2-modis-mod13a2-1" class="level4">
<h4 class="anchored" data-anchor-id="example-2-modis-mod13a2-1">Example 2 (MODIS MOD13A2)</h4>
<pre><code>{
  "datetime" : {
      "pattern" : ".*M[OY]D13A2\\.A(.{7}).*",
      "format" : "%Y%j"} 
}</code></pre>
<p>Example input GDAL dataset identifiers and extracted <strong>date/time string</strong> (bold):</p>
<pre>1. HDF4_EOS:EOS_GRID:"/path/to/MOD13A2.A<b>2013353</b>.h00v08.006.2018226105756.hdf\\":MODIS_Grid_16DAY_1km_VI:1 km 16 days NDVI
2. HDF4_EOS:EOS_GRID:"/path/to/MOD13A2.A<b>2013353</b>.h20v03.006.2018226105924.hdf\\":MODIS_Grid_16DAY_1km_VI:1 km 16 days NDVI
3. HDF4_EOS:EOS_GRID:"/path/to/MOD13A2.A<b>2015033</b>.h23v10.006.2015296122819.hdf\\":MODIS_Grid_16DAY_1km_VI:1 km 16 days VI Quality
</pre>
<p>Some MODIS and climate model output datsets are provided as multidimensional HDF or netCDF files, where one file (or GDAL dataset) contains space and time of one variable. In these cases, GDAL exposes the additional time dimension as bands. For such datasets, gdalcubes supports the additional definition of the <em>duration</em> of a band. This duration is then added to the offset date/time, which is extracted from the filename as described below.</p>
<hr>
</section>
<section id="example-3-pr_day_hadgem2-es_historical_r1i1p1" class="level4">
<h4 class="anchored" data-anchor-id="example-3-pr_day_hadgem2-es_historical_r1i1p1">Example 3 (pr_day_HadGEM2-ES_historical_r1i1p1)</h4>
<pre><code>{
  "datetime" : {
      "pattern" : ".*pr_day_HadGEM2-ES_historical_r1i1p1_EWEMBI_([0-9]{8}).*",
      "format" : "%Y%m%d",
      "bands" : {
          "dt" : "P1D" }}
}</code></pre>
<p>In this example the 10th band (zero-based) for example represents 10 days after the date extracted from the filename.</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>This feature is experimental and only available in the development version.</p>
</div>
</div>
</section>
</section>
<section id="defining-bands" class="level3">
<h3 class="anchored" data-anchor-id="defining-bands">Defining bands</h3>
<p>The <code>bands</code> object lists the bands of a data product as key value pairs, where the key is a unique band name, and the value is a JSON object with a pattern and optional other fields. The <code>pattern</code> field again defines a regular expression. If a GDAL dataset identifier matches the pattern, it is considered to contain data of the band. A dataset identifier may match the pattern of several bands (sometimes, all bands even define the same pattern) if a single input GDAL dataset contains multiple bands. In this case, the additional field <code>band</code> can be used to describe which internal band corresponds to the band of the image collection. <code>band</code> can be a one-based integer number and is identical to the band number of GDAL (as from running <code>gdalinfo</code>).</p>
<p>Some additional per-band metadata fields may be added to band definitions. In the current version, these include <code>nodata</code>, <code>scale</code>, <code>offset</code>, and <code>unit</code>. If these values are not provided, they are derived from the GDAL metadata (which may or may not be defined).</p>
<section id="example-1-one-gdal-dataset---one-band" class="level4">
<h4 class="anchored" data-anchor-id="example-1-one-gdal-dataset---one-band">Example 1: One GDAL dataset - one band</h4>
<p>The following example can be used to define some of the bands of Landsat 8 surface reflectance data, where each band is stored in a separate GeoTIFF file.</p>
<pre><code>{
    "bands": {
        "B01" : {
            "pattern" : ".+sr_band1\\.tif",
            "nodata" : -9999},
        "B02" : {
            "pattern" : ".+sr_band2\\.tif",
            "nodata" : -9999},
        "B03" : {
            "pattern" : ".+sr_band3\\.tif",
            "nodata" : -9999},
        "B04" : {
            "pattern" : ".+sr_band4\\.tif",
            "nodata" : -9999},
        "B05" : {
            "pattern" : ".+sr_band5\\.tif",
            "nodata" : -9999},
        "B06" : {
            "pattern" : ".+sr_band6\\.tif",
            "nodata" : -9999},
        "B07" : {
            "pattern" : ".+sr_band7\\.tif",
            "nodata" : -9999},
        "..."
    }
}</code></pre>
</section>
<section id="example-2-one-gdal-dataset---many-bands" class="level4">
<h4 class="anchored" data-anchor-id="example-2-one-gdal-dataset---many-bands">Example 2: One GDAL dataset - many bands</h4>
<p>The following example can be used to define bands of PlanetScope surface reflectance data, where all bands (except a mask band) are stored in a single GeoTIFF file.</p>
<pre><code> {
      "bands" : {
          "red" : {
              "nodata" : 0,
              "pattern" : ".+_AnalyticMS_SR\\.tif$",
              "band" : 3},
          "green" : {
              "nodata" : 0,
              "pattern" : ".+_AnalyticMS_SR\\.tif$",
              "band" : 2},
          "blue" : {
              "nodata" : 0,
              "pattern" : ".+_AnalyticMS_SR\\.tif$",
              "band" : 1},
          "nir" : {
              "nodata" : 0,
              "pattern" : ".+_AnalyticMS_SR\\.tif$",
              "band" : 4},
          "..."
      }
 }</code></pre>
</section>
</section>
<section id="reading-gdal-subdatasets" class="level3">
<h3 class="anchored" data-anchor-id="reading-gdal-subdatasets">Reading GDAL subdatasets</h3>
<p>For some data products (such as MODIS), bands are distributed as GDAL subdatasets within a single file (typically NetCDF or HDF). Adding <code>"subdatasets" : true</code> to the top-level JSON object makes sure that all subdatasets will be considered automatically. Other patterns of the collection format to extract image names amd date/time then relate to subdataset identifiers.</p>
</section>
<section id="defining-a-global-spatial-reference-system" class="level3">
<h3 class="anchored" data-anchor-id="defining-a-global-spatial-reference-system">Defining a global spatial reference system</h3>
<p>Some global climate data products distributed as NetCDF files do not encode the SRS of images in a way that GDAL reads automatically. In these cases the collection format allows to define a global spatial reference system that overwrites the reference system of individual images (if available). For example, adding <code>"srs" : "EPSG:4326"</code> to the top-level JSON object makes sure that the WGS84 spatial reference system will be used for all images.</p>
</section>
<section id="additional-image-metadata" class="level3">
<h3 class="anchored" data-anchor-id="additional-image-metadata">Additional image metadata</h3>
<p>It is possible to extract further per-image metadata key value pairs from GDAL datasets. The collection format may include an optional field “image_md_fields” to list metadata keys as a JSON array of strings. When GDAL datasets are opened, GDAL tries to find the corresponding metadata keys and stores corresponding values in the image metadata table of the image collection.</p>
<p>Metadata fields may be separated by domains (see <a href="https://gdal.org/user/raster_data_model.html#metadata">GDAL metadata model</a>). If metadata fields from a specific domain are needed, you can use <code>DOMAIN:KEY</code>, such as <code>IMAGERY:CLOUDCOVER</code>. The example below could be used to get some per-image quality flags from MODIS metadata.</p>
<pre><code>{"image_md_fields" : ["PERCENTLAND", "QAPERCENTGOODQUALITY", "QAPERCENTNOTPRODUCEDCLOUD"]}</code></pre>
</section>
</section>
<section id="complete-examples" class="level2">
<h2 class="anchored" data-anchor-id="complete-examples">Complete examples</h2>
<p>Complete examples of image collection formats can be found in the sources. There is also a <a href="https://github.com/appelmar/gdalcubes_formats/tree/master/formats">dedicated GitHub repository</a></p>
</section>
<section id="notes-on-writing-custom-collection-formats" class="level2">
<h2 class="anchored" data-anchor-id="notes-on-writing-custom-collection-formats">Notes on writing custom collection formats</h2>
<p>When writing a collection format for new data products, please make sure to check the following notes:</p>
<ul>
<li>If available, read the data product handbook. Most official satellite image product handbooks include a section on filenaming conventions.</li>
<li>For portability of local file-based image collections, make sure that preceding directory names (e.g.&nbsp;“C:\Users\”, or “/home/user/data”) do not matter to successfully create image collections.<br>
</li>
<li>If possible, avoid using path separators in regular expressions or use <em>non-capturing alternation</em> <code>(?:/|\\)</code> if you have to.</li>
<li>Image collections do not need to include data for all bands. It is recommended to list all possible bands of a data product in the format. For example, Landsat 8 surface reflectance products may or may not include additional precomputed spectral index bands. To be able to use these bands if available, they must be listed in the collection format.</li>
</ul>


<!-- -->

</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  const viewSource = window.document.getElementById('quarto-view-source') ||
                     window.document.getElementById('quarto-code-tools-source');
  if (viewSource) {
    const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
    viewSource.addEventListener("click", function(e) {
      if (sourceUrl) {
        // rstudio viewer pane
        if (/\bcapabilities=\b/.test(window.location)) {
          window.open(sourceUrl);
        } else {
          window.location.href = sourceUrl;
        }
      } else {
        const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
        modal.show();
      }
      return false;
    });
  }
  function toggleCodeHandler(show) {
    return function(e) {
      const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
      for (let i=0; i<detailsSrc.length; i++) {
        const details = detailsSrc[i].parentElement;
        if (show) {
          details.open = true;
        } else {
          details.removeAttribute("open");
        }
      }
      const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
      const fromCls = show ? "hidden" : "unhidden";
      const toCls = show ? "unhidden" : "hidden";
      for (let i=0; i<cellCodeDivs.length; i++) {
        const codeDiv = cellCodeDivs[i];
        if (codeDiv.classList.contains(fromCls)) {
          codeDiv.classList.remove(fromCls);
          codeDiv.classList.add(toCls);
        } 
      }
      return false;
    }
  }
  const hideAllCode = window.document.getElementById("quarto-hide-all-code");
  if (hideAllCode) {
    hideAllCode.addEventListener("click", toggleCodeHandler(false));
  }
  const showAllCode = window.document.getElementById("quarto-show-all-code");
  if (showAllCode) {
    showAllCode.addEventListener("click", toggleCodeHandler(true));
  }
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
          // target, if specified
          link.setAttribute("target", "_blank");
          // default icon
          link.classList.add("external");
      }
    }
});
</script><div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="quarto-embedded-source-code-modal-label">Source Code</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="">
<div class="sourceCode" id="cb10" data-shortcodes="false"><pre class="sourceCode numberSource markdown number-lines code-with-copy"><code class="sourceCode markdown"><span id="cb10-1"><a href="#cb10-1"></a><span class="fu"># Image collection formats</span></span>
<span id="cb10-2"><a href="#cb10-2"></a></span>
<span id="cb10-3"><a href="#cb10-3"></a>Image collection formats describe how image collections are composed from GDAL datasets, considering specific data product organizations.</span>
<span id="cb10-4"><a href="#cb10-4"></a></span>
<span id="cb10-5"><a href="#cb10-5"></a>A collection format is a JSON file defining rules, how to derive required metadata when a GDAL dataset </span>
<span id="cb10-6"><a href="#cb10-6"></a>(specified by its identifier, e.g. the path to a local GeoTIFF file) is added to an image collection.</span>
<span id="cb10-7"><a href="#cb10-7"></a></span>
<span id="cb10-8"><a href="#cb10-8"></a>When adding a GDAL dataset (given its identifier) to a collection, we must find out</span>
<span id="cb10-9"><a href="#cb10-9"></a></span>
<span id="cb10-10"><a href="#cb10-10"></a><span class="ss">- </span>to which image the dataset belongs (identified by a unique image name),</span>
<span id="cb10-11"><a href="#cb10-11"></a><span class="ss">- </span>the recording date/time of the dataset, and</span>
<span id="cb10-12"><a href="#cb10-12"></a><span class="ss">- </span>how bands of the dataset relate to bands of the collection.</span>
<span id="cb10-13"><a href="#cb10-13"></a></span>
<span id="cb10-14"><a href="#cb10-14"></a></span>
<span id="cb10-15"><a href="#cb10-15"></a></span>
<span id="cb10-16"><a href="#cb10-16"></a><span class="fu">## Regular expressions</span></span>
<span id="cb10-17"><a href="#cb10-17"></a></span>
<span id="cb10-18"><a href="#cb10-18"></a>Rules are mostly defined as regular expresions on the GDAL dataset identifiers. Some expressions</span>
<span id="cb10-19"><a href="#cb10-19"></a>simply check whether a dataset *matches* the expression or not, whereas some expression return a captured substring (e.g. the datetime part). gdalcubes uses the <span class="co">[</span><span class="ot">standard C++11 regular expression library</span><span class="co">](http://www.cplusplus.com/reference/regex)</span> with default <span class="co">[</span><span class="ot">ECMAScript</span><span class="co">](http://www.cplusplus.com/reference/regex/ECMAScript)</span> syntax.</span>
<span id="cb10-20"><a href="#cb10-20"></a></span>
<span id="cb10-21"><a href="#cb10-21"></a></span>
<span id="cb10-22"><a href="#cb10-22"></a></span>
<span id="cb10-23"><a href="#cb10-23"></a><span class="fu">## JSON format</span></span>
<span id="cb10-24"><a href="#cb10-24"></a></span>
<span id="cb10-25"><a href="#cb10-25"></a></span>
<span id="cb10-26"><a href="#cb10-26"></a><span class="fu">### Header information</span></span>
<span id="cb10-27"><a href="#cb10-27"></a></span>
<span id="cb10-28"><a href="#cb10-28"></a>The JSON files for image collection formats start with some header information, </span>
<span id="cb10-29"><a href="#cb10-29"></a>including a short description of the particular product it adresses and some keywords. These header information are optional, but may be useful for searching.</span>
<span id="cb10-30"><a href="#cb10-30"></a></span>
<span id="cb10-31"><a href="#cb10-31"></a>For example, the following description and tags are used in the collection format</span>
<span id="cb10-32"><a href="#cb10-32"></a>for Sentinel 2 Level 2A products.</span>
<span id="cb10-33"><a href="#cb10-33"></a></span>
<span id="cb10-34"><a href="#cb10-34"></a><span class="in">```</span></span>
<span id="cb10-35"><a href="#cb10-35"></a><span class="in">{</span></span>
<span id="cb10-36"><a href="#cb10-36"></a><span class="in">    "description" : "Image collection format for Sentinel 2 Level 2A data as downloaded from the Copernicus Open Access Hub, expects a list of file paths as input. The format should work on original ZIP compressed as well as uncompressed imagery.",</span></span>
<span id="cb10-37"><a href="#cb10-37"></a><span class="in">    "tags" : ["Sentinel", "Copernicus", "ESA", "BOA", "Surface Reflectance"]</span></span>
<span id="cb10-38"><a href="#cb10-38"></a><span class="in">}</span></span>
<span id="cb10-39"><a href="#cb10-39"></a><span class="in">```</span></span>
<span id="cb10-40"><a href="#cb10-40"></a></span>
<span id="cb10-41"><a href="#cb10-41"></a></span>
<span id="cb10-42"><a href="#cb10-42"></a></span>
<span id="cb10-43"><a href="#cb10-43"></a></span>
<span id="cb10-44"><a href="#cb10-44"></a><span class="fu">### Global dataset pattern </span></span>
<span id="cb10-45"><a href="#cb10-45"></a></span>
<span id="cb10-46"><a href="#cb10-46"></a>Collection formats include a global pattern as a regular expression </span>
<span id="cb10-47"><a href="#cb10-47"></a>such that input GDAL datasets not matching the regular expression will </span>
<span id="cb10-48"><a href="#cb10-48"></a>simply be ignored (quietly, without throwing exceptions). </span>
<span id="cb10-49"><a href="#cb10-49"></a>As a simple example, setting <span class="in">`"pattern" : ".*\\.tif$"`</span></span>
<span id="cb10-50"><a href="#cb10-50"></a>would ignore files that do not end with ".tif".  </span>
<span id="cb10-51"><a href="#cb10-51"></a></span>
<span id="cb10-52"><a href="#cb10-52"></a></span>
<span id="cb10-53"><a href="#cb10-53"></a></span>
<span id="cb10-54"><a href="#cb10-54"></a></span>
<span id="cb10-55"><a href="#cb10-55"></a><span class="fu">### Grouping datasets by image names</span></span>
<span id="cb10-56"><a href="#cb10-56"></a></span>
<span id="cb10-57"><a href="#cb10-57"></a></span>
<span id="cb10-58"><a href="#cb10-58"></a>Images can be composed from one or more GDAL datasets, </span>
<span id="cb10-59"><a href="#cb10-59"></a>where all datasets share the spatial extent, the spatial </span>
<span id="cb10-60"><a href="#cb10-60"></a>reference system, and acquisition date/time, </span>
<span id="cb10-61"><a href="#cb10-61"></a>but different datasets contain data for different bands. </span>
<span id="cb10-62"><a href="#cb10-62"></a></span>
<span id="cb10-63"><a href="#cb10-63"></a>gdalcubes uses a regular expression to extract an *image name* </span>
<span id="cb10-64"><a href="#cb10-64"></a>from the GDAL dataset identifier. </span>
<span id="cb10-65"><a href="#cb10-65"></a>The extracted name must be identical for all datasets </span>
<span id="cb10-66"><a href="#cb10-66"></a>belonging to the same image.</span>
<span id="cb10-67"><a href="#cb10-67"></a></span>
<span id="cb10-68"><a href="#cb10-68"></a>To extract the image name from the identifier, </span>
<span id="cb10-69"><a href="#cb10-69"></a>the first *marked subexpression* (or *capturing group*) of the </span>
<span id="cb10-70"><a href="#cb10-70"></a>provided regular expression under <span class="in">`"images" : {"pattern": "REGEX"}`</span></span>
<span id="cb10-71"><a href="#cb10-71"></a>is used, i.e., a part in the expression within the first pair of parentheses. </span>
<span id="cb10-72"><a href="#cb10-72"></a></span>
<span id="cb10-73"><a href="#cb10-73"></a>---</span>
<span id="cb10-74"><a href="#cb10-74"></a></span>
<span id="cb10-75"><a href="#cb10-75"></a><span class="fu">#### Example 1 (Landsat 8 surface reflectance)</span></span>
<span id="cb10-76"><a href="#cb10-76"></a></span>
<span id="cb10-77"><a href="#cb10-77"></a><span class="in">```</span></span>
<span id="cb10-78"><a href="#cb10-78"></a><span class="in">{"images":{"pattern":".*(L[OTC]08_.{4}_.{6}_.{8}_.{8}_.{2}_.{2})[A-Za-z0-9_]+\\.tif"}}</span></span>
<span id="cb10-79"><a href="#cb10-79"></a><span class="in">```</span></span>
<span id="cb10-80"><a href="#cb10-80"></a></span>
<span id="cb10-81"><a href="#cb10-81"></a></span>
<span id="cb10-82"><a href="#cb10-82"></a></span>
<span id="cb10-83"><a href="#cb10-83"></a>Example input GDAL dataset identifiers and extracted **image name** (bold):</span>
<span id="cb10-84"><a href="#cb10-84"></a></span>
<span id="cb10-85"><a href="#cb10-85"></a><span class="kw">&lt;pre&gt;</span></span>
<span id="cb10-86"><a href="#cb10-86"></a><span class="ss">1. </span>/path/to/<span class="kw">&lt;b&gt;</span>LC08_L1TP_226063_20140719_20170421_01_T1&lt;/b&gt;_sr_band2.tif</span>
<span id="cb10-87"><a href="#cb10-87"></a><span class="ss">2. </span>/path/to/<span class="kw">&lt;b&gt;</span>LC08_L1TP_226063_20140820_20170420_01_T1&lt;/b&gt;_sr_aerosol.tif</span>
<span id="cb10-88"><a href="#cb10-88"></a><span class="ss">3. </span>/path/to/<span class="kw">&lt;b&gt;</span>LC08_L1TP_227064_20130621_20170503_01_T1&lt;/b&gt;_pixel_qa.tif</span>
<span id="cb10-89"><a href="#cb10-89"></a><span class="kw">&lt;/pre&gt;</span></span>
<span id="cb10-90"><a href="#cb10-90"></a></span>
<span id="cb10-91"><a href="#cb10-91"></a></span>
<span id="cb10-92"><a href="#cb10-92"></a></span>
<span id="cb10-93"><a href="#cb10-93"></a>---</span>
<span id="cb10-94"><a href="#cb10-94"></a></span>
<span id="cb10-95"><a href="#cb10-95"></a></span>
<span id="cb10-96"><a href="#cb10-96"></a><span class="fu">#### Example 2 (MODIS MOD13A2)</span></span>
<span id="cb10-97"><a href="#cb10-97"></a></span>
<span id="cb10-98"><a href="#cb10-98"></a></span>
<span id="cb10-99"><a href="#cb10-99"></a></span>
<span id="cb10-100"><a href="#cb10-100"></a><span class="in">```</span></span>
<span id="cb10-101"><a href="#cb10-101"></a><span class="in">{"images":{"pattern":"HDF4_EOS:EOS_GRID:\".+(MOD13A2\\.A.+)\\.hdf.*"}}</span></span>
<span id="cb10-102"><a href="#cb10-102"></a><span class="in">```</span></span>
<span id="cb10-103"><a href="#cb10-103"></a></span>
<span id="cb10-104"><a href="#cb10-104"></a></span>
<span id="cb10-105"><a href="#cb10-105"></a>Example input GDAL dataset identifiers and extracted **image name** (bold):</span>
<span id="cb10-106"><a href="#cb10-106"></a></span>
<span id="cb10-107"><a href="#cb10-107"></a><span class="kw">&lt;pre&gt;</span></span>
<span id="cb10-108"><a href="#cb10-108"></a><span class="ss">1. </span>HDF4_EOS:EOS_GRID:"/path/to/<span class="kw">&lt;b&gt;</span>MOD13A2.A2013353.h00v08.006.2018226105756<span class="kw">&lt;/b&gt;</span>.hdf":MODIS_Grid_16DAY_1km_VI:1 km 16 days NDVI</span>
<span id="cb10-109"><a href="#cb10-109"></a><span class="ss">2. </span>HDF4_EOS:EOS_GRID:"/path/to/<span class="kw">&lt;b&gt;</span>MOD13A2.A2013353.h20v03.006.2018226105924<span class="kw">&lt;/b&gt;</span>.hdf":MODIS_Grid_16DAY_1km_VI:1 km 16 days NDVI </span>
<span id="cb10-110"><a href="#cb10-110"></a><span class="ss">3. </span>HDF4_EOS:EOS_GRID:"/path/to/<span class="kw">&lt;b&gt;</span>MOD13A2.A2015033.h23v10.006.2015296122819<span class="kw">&lt;/b&gt;</span>.hdf":MODIS_Grid_16DAY_1km_VI:1 km 16 days VI Quality</span>
<span id="cb10-111"><a href="#cb10-111"></a><span class="kw">&lt;/pre&gt;</span></span>
<span id="cb10-112"><a href="#cb10-112"></a></span>
<span id="cb10-113"><a href="#cb10-113"></a>---</span>
<span id="cb10-114"><a href="#cb10-114"></a></span>
<span id="cb10-115"><a href="#cb10-115"></a><span class="fu">### Extracting date/time information</span></span>
<span id="cb10-116"><a href="#cb10-116"></a></span>
<span id="cb10-117"><a href="#cb10-117"></a>In the current version of gdalcubes, the acquisition </span>
<span id="cb10-118"><a href="#cb10-118"></a>date/time of images is derived from the dataset identifiers. </span>
<span id="cb10-119"><a href="#cb10-119"></a>Similar to the extraction of image names, a pattern defines a regular expression where the first marked subexpression / capturing group within parentheses is extracted. The ``format`` field in ``datetime`` JSON object then defines how to convert the extracted string to a date/time object, according to the <span class="co">[</span><span class="ot">strptime function</span><span class="co">](https://pubs.opengroup.org/onlinepubs/9699919799/functions/strptime.html)</span>.</span>
<span id="cb10-120"><a href="#cb10-120"></a></span>
<span id="cb10-121"><a href="#cb10-121"></a></span>
<span id="cb10-122"><a href="#cb10-122"></a>---</span>
<span id="cb10-123"><a href="#cb10-123"></a></span>
<span id="cb10-124"><a href="#cb10-124"></a><span class="fu">#### Example 1 (Sentinel 2 Level 2A SAFE format, from .zip files)</span></span>
<span id="cb10-125"><a href="#cb10-125"></a></span>
<span id="cb10-126"><a href="#cb10-126"></a></span>
<span id="cb10-127"><a href="#cb10-127"></a><span class="in">```</span></span>
<span id="cb10-128"><a href="#cb10-128"></a><span class="in">{</span></span>
<span id="cb10-129"><a href="#cb10-129"></a><span class="in">   "datetime" : {</span></span>
<span id="cb10-130"><a href="#cb10-130"></a><span class="in">       "pattern" : ".*MSIL2A_(.+?)_.*\\.zip.*",</span></span>
<span id="cb10-131"><a href="#cb10-131"></a><span class="in">       "format" : "%Y%m%dT%H%M%S"}  </span></span>
<span id="cb10-132"><a href="#cb10-132"></a><span class="in">} </span></span>
<span id="cb10-133"><a href="#cb10-133"></a><span class="in">```</span></span>
<span id="cb10-134"><a href="#cb10-134"></a></span>
<span id="cb10-135"><a href="#cb10-135"></a></span>
<span id="cb10-136"><a href="#cb10-136"></a></span>
<span id="cb10-137"><a href="#cb10-137"></a></span>
<span id="cb10-138"><a href="#cb10-138"></a></span>
<span id="cb10-139"><a href="#cb10-139"></a>Example input GDAL dataset identifiers and extracted **date/time string** (bold):</span>
<span id="cb10-140"><a href="#cb10-140"></a></span>
<span id="cb10-141"><a href="#cb10-141"></a><span class="kw">&lt;pre&gt;</span></span>
<span id="cb10-142"><a href="#cb10-142"></a><span class="ss">1. </span>/vsizip//path/to/S2A_MSIL2A_&lt;b&gt;20180328T093031&lt;/b&gt;_N0207_R136_T34UFD_20180328T145945.zip/S2A_MSIL2A_20180328T093031_N0207_R136_T34UFD_20180328T145945.SAFE/GRANULE/L2A_T34UFD_A014433_20180328T093032/IMG_DATA/R20m/T34UFD_20180328T093031_B8A_20m.jp2"</span>
<span id="cb10-143"><a href="#cb10-143"></a><span class="ss">2. </span>/vsizip//path/to/S2A_MSIL2A_&lt;b&gt;20180328T093031&lt;/b&gt;_N0207_R136_T34UFD_20180328T145945.zip/S2A_MSIL2A_20180328T093031_N0207_R136_T34UFD_20180328T145945.SAFE/GRANULE/L2A_T34UFD_A014433_20180328T093032/IMG_DATA/R20m/T34UFD_20180328T093031_SCL_20m.jp2</span>
<span id="cb10-144"><a href="#cb10-144"></a><span class="ss">3. </span>/vsizip//path/to/S2A_MSIL2A_&lt;b&gt;20180430T094031&lt;/b&gt;_N0207_R036_T34UGD_20180430T114456.zip/S2A_MSIL2A_20180430T094031_N0207_R036_T34UGD_20180430T114456.SAFE/GRANULE/L2A_T34UGD_A014905_20180430T094109/IMG_DATA/R10m/T34UGD_20180430T094031_B08_10m.jp2</span>
<span id="cb10-145"><a href="#cb10-145"></a><span class="kw">&lt;/pre&gt;</span></span>
<span id="cb10-146"><a href="#cb10-146"></a></span>
<span id="cb10-147"><a href="#cb10-147"></a></span>
<span id="cb10-148"><a href="#cb10-148"></a></span>
<span id="cb10-149"><a href="#cb10-149"></a>---</span>
<span id="cb10-150"><a href="#cb10-150"></a></span>
<span id="cb10-151"><a href="#cb10-151"></a></span>
<span id="cb10-152"><a href="#cb10-152"></a><span class="fu">#### Example 2 (MODIS MOD13A2)</span></span>
<span id="cb10-153"><a href="#cb10-153"></a></span>
<span id="cb10-154"><a href="#cb10-154"></a><span class="in">```</span></span>
<span id="cb10-155"><a href="#cb10-155"></a><span class="in">{</span></span>
<span id="cb10-156"><a href="#cb10-156"></a><span class="in">  "datetime" : {</span></span>
<span id="cb10-157"><a href="#cb10-157"></a><span class="in">      "pattern" : ".*M[OY]D13A2\\.A(.{7}).*",</span></span>
<span id="cb10-158"><a href="#cb10-158"></a><span class="in">      "format" : "%Y%j"} </span></span>
<span id="cb10-159"><a href="#cb10-159"></a><span class="in">}</span></span>
<span id="cb10-160"><a href="#cb10-160"></a><span class="in">```</span></span>
<span id="cb10-161"><a href="#cb10-161"></a></span>
<span id="cb10-162"><a href="#cb10-162"></a></span>
<span id="cb10-163"><a href="#cb10-163"></a>Example input GDAL dataset identifiers and extracted **date/time string** (bold):</span>
<span id="cb10-164"><a href="#cb10-164"></a></span>
<span id="cb10-165"><a href="#cb10-165"></a><span class="kw">&lt;pre&gt;</span></span>
<span id="cb10-166"><a href="#cb10-166"></a><span class="ss">1. </span>HDF4_EOS:EOS_GRID:"/path/to/MOD13A2.A<span class="kw">&lt;b&gt;</span>2013353<span class="kw">&lt;/b&gt;</span>.h00v08.006.2018226105756.hdf<span class="sc">\\</span>":MODIS_Grid_16DAY_1km_VI:1 km 16 days NDVI</span>
<span id="cb10-167"><a href="#cb10-167"></a><span class="ss">2. </span>HDF4_EOS:EOS_GRID:"/path/to/MOD13A2.A<span class="kw">&lt;b&gt;</span>2013353<span class="kw">&lt;/b&gt;</span>.h20v03.006.2018226105924.hdf<span class="sc">\\</span>":MODIS_Grid_16DAY_1km_VI:1 km 16 days NDVI</span>
<span id="cb10-168"><a href="#cb10-168"></a><span class="ss">3. </span>HDF4_EOS:EOS_GRID:"/path/to/MOD13A2.A<span class="kw">&lt;b&gt;</span>2015033<span class="kw">&lt;/b&gt;</span>.h23v10.006.2015296122819.hdf<span class="sc">\\</span>":MODIS_Grid_16DAY_1km_VI:1 km 16 days VI Quality</span>
<span id="cb10-169"><a href="#cb10-169"></a><span class="kw">&lt;/pre&gt;</span></span>
<span id="cb10-170"><a href="#cb10-170"></a></span>
<span id="cb10-171"><a href="#cb10-171"></a></span>
<span id="cb10-172"><a href="#cb10-172"></a></span>
<span id="cb10-173"><a href="#cb10-173"></a></span>
<span id="cb10-174"><a href="#cb10-174"></a></span>
<span id="cb10-175"><a href="#cb10-175"></a></span>
<span id="cb10-176"><a href="#cb10-176"></a></span>
<span id="cb10-177"><a href="#cb10-177"></a></span>
<span id="cb10-178"><a href="#cb10-178"></a>Some MODIS and climate model output datsets are provided as multidimensional HDF or netCDF files, where one file (or GDAL dataset) contains space and time of one variable.  In these cases, GDAL exposes the additional time dimension as bands. For such datasets, gdalcubes supports the additional definition of the *duration* of a band. This duration is then added to the offset date/time, which is extracted from the filename as described below. </span>
<span id="cb10-179"><a href="#cb10-179"></a></span>
<span id="cb10-180"><a href="#cb10-180"></a>---</span>
<span id="cb10-181"><a href="#cb10-181"></a></span>
<span id="cb10-182"><a href="#cb10-182"></a><span class="fu">#### Example 3 (pr_day_HadGEM2-ES_historical_r1i1p1)</span></span>
<span id="cb10-183"><a href="#cb10-183"></a></span>
<span id="cb10-184"><a href="#cb10-184"></a><span class="in">```</span></span>
<span id="cb10-185"><a href="#cb10-185"></a><span class="in">{</span></span>
<span id="cb10-186"><a href="#cb10-186"></a><span class="in">  "datetime" : {</span></span>
<span id="cb10-187"><a href="#cb10-187"></a><span class="in">      "pattern" : ".*pr_day_HadGEM2-ES_historical_r1i1p1_EWEMBI_([0-9]{8}).*",</span></span>
<span id="cb10-188"><a href="#cb10-188"></a><span class="in">      "format" : "%Y%m%d",</span></span>
<span id="cb10-189"><a href="#cb10-189"></a><span class="in">      "bands" : {</span></span>
<span id="cb10-190"><a href="#cb10-190"></a><span class="in">          "dt" : "P1D" }}</span></span>
<span id="cb10-191"><a href="#cb10-191"></a><span class="in">}</span></span>
<span id="cb10-192"><a href="#cb10-192"></a><span class="in">```</span></span>
<span id="cb10-193"><a href="#cb10-193"></a></span>
<span id="cb10-194"><a href="#cb10-194"></a>In this example the 10th band (zero-based) for example represents 10 days after the date extracted from the filename.</span>
<span id="cb10-195"><a href="#cb10-195"></a></span>
<span id="cb10-196"><a href="#cb10-196"></a>:::{.callout-note}</span>
<span id="cb10-197"><a href="#cb10-197"></a>This feature is experimental and only available in the development version.</span>
<span id="cb10-198"><a href="#cb10-198"></a>:::</span>
<span id="cb10-199"><a href="#cb10-199"></a>   </span>
<span id="cb10-200"><a href="#cb10-200"></a></span>
<span id="cb10-201"><a href="#cb10-201"></a></span>
<span id="cb10-202"><a href="#cb10-202"></a></span>
<span id="cb10-203"><a href="#cb10-203"></a></span>
<span id="cb10-204"><a href="#cb10-204"></a></span>
<span id="cb10-205"><a href="#cb10-205"></a><span class="fu">### Defining bands</span></span>
<span id="cb10-206"><a href="#cb10-206"></a></span>
<span id="cb10-207"><a href="#cb10-207"></a></span>
<span id="cb10-208"><a href="#cb10-208"></a>The <span class="in">`bands`</span> object lists the bands of a data product as key value pairs, where the key is a unique band name, and the value is a JSON object with a pattern and optional other fields. The <span class="in">`pattern`</span> field again defines a regular expression. If a GDAL dataset identifier matches the pattern, it is considered to contain data of the band.  A dataset identifier may match the pattern of several bands (sometimes, all bands even define the same pattern) if a single input GDAL dataset contains multiple bands. In this case, the additional field <span class="in">`band`</span> can be used to describe which internal band corresponds to the band of the image collection. <span class="in">`band`</span> can be a one-based integer number and is identical to the band number of GDAL (as from running <span class="in">`gdalinfo`</span>).</span>
<span id="cb10-209"><a href="#cb10-209"></a></span>
<span id="cb10-210"><a href="#cb10-210"></a></span>
<span id="cb10-211"><a href="#cb10-211"></a>Some additional per-band metadata fields may be added to band definitions. In the current version, these include <span class="in">`nodata`</span>, <span class="in">`scale`</span>, <span class="in">`offset`</span>, and <span class="in">`unit`</span>. If these values are not provided, they are derived from the GDAL metadata (which may or may not be defined).</span>
<span id="cb10-212"><a href="#cb10-212"></a></span>
<span id="cb10-213"><a href="#cb10-213"></a></span>
<span id="cb10-214"><a href="#cb10-214"></a><span class="fu">#### Example 1: One GDAL dataset - one band</span></span>
<span id="cb10-215"><a href="#cb10-215"></a></span>
<span id="cb10-216"><a href="#cb10-216"></a>The following example can be used to define some of the bands of Landsat 8 surface reflectance data, where each band is stored in a separate GeoTIFF file.</span>
<span id="cb10-217"><a href="#cb10-217"></a></span>
<span id="cb10-218"><a href="#cb10-218"></a><span class="in">```</span></span>
<span id="cb10-219"><a href="#cb10-219"></a><span class="in">{</span></span>
<span id="cb10-220"><a href="#cb10-220"></a><span class="in">    "bands": {</span></span>
<span id="cb10-221"><a href="#cb10-221"></a><span class="in">        "B01" : {</span></span>
<span id="cb10-222"><a href="#cb10-222"></a><span class="in">            "pattern" : ".+sr_band1\\.tif",</span></span>
<span id="cb10-223"><a href="#cb10-223"></a><span class="in">            "nodata" : -9999},</span></span>
<span id="cb10-224"><a href="#cb10-224"></a><span class="in">        "B02" : {</span></span>
<span id="cb10-225"><a href="#cb10-225"></a><span class="in">            "pattern" : ".+sr_band2\\.tif",</span></span>
<span id="cb10-226"><a href="#cb10-226"></a><span class="in">            "nodata" : -9999},</span></span>
<span id="cb10-227"><a href="#cb10-227"></a><span class="in">        "B03" : {</span></span>
<span id="cb10-228"><a href="#cb10-228"></a><span class="in">            "pattern" : ".+sr_band3\\.tif",</span></span>
<span id="cb10-229"><a href="#cb10-229"></a><span class="in">            "nodata" : -9999},</span></span>
<span id="cb10-230"><a href="#cb10-230"></a><span class="in">        "B04" : {</span></span>
<span id="cb10-231"><a href="#cb10-231"></a><span class="in">            "pattern" : ".+sr_band4\\.tif",</span></span>
<span id="cb10-232"><a href="#cb10-232"></a><span class="in">            "nodata" : -9999},</span></span>
<span id="cb10-233"><a href="#cb10-233"></a><span class="in">        "B05" : {</span></span>
<span id="cb10-234"><a href="#cb10-234"></a><span class="in">            "pattern" : ".+sr_band5\\.tif",</span></span>
<span id="cb10-235"><a href="#cb10-235"></a><span class="in">            "nodata" : -9999},</span></span>
<span id="cb10-236"><a href="#cb10-236"></a><span class="in">        "B06" : {</span></span>
<span id="cb10-237"><a href="#cb10-237"></a><span class="in">            "pattern" : ".+sr_band6\\.tif",</span></span>
<span id="cb10-238"><a href="#cb10-238"></a><span class="in">            "nodata" : -9999},</span></span>
<span id="cb10-239"><a href="#cb10-239"></a><span class="in">        "B07" : {</span></span>
<span id="cb10-240"><a href="#cb10-240"></a><span class="in">            "pattern" : ".+sr_band7\\.tif",</span></span>
<span id="cb10-241"><a href="#cb10-241"></a><span class="in">            "nodata" : -9999},</span></span>
<span id="cb10-242"><a href="#cb10-242"></a><span class="in">        "..."</span></span>
<span id="cb10-243"><a href="#cb10-243"></a><span class="in">    }</span></span>
<span id="cb10-244"><a href="#cb10-244"></a><span class="in">}</span></span>
<span id="cb10-245"><a href="#cb10-245"></a><span class="in">```</span></span>
<span id="cb10-246"><a href="#cb10-246"></a></span>
<span id="cb10-247"><a href="#cb10-247"></a><span class="fu">#### Example 2: One GDAL dataset - many bands</span></span>
<span id="cb10-248"><a href="#cb10-248"></a></span>
<span id="cb10-249"><a href="#cb10-249"></a>The following example can be used to define bands of PlanetScope surface reflectance data, where all bands (except a mask band) are stored in a single GeoTIFF file.</span>
<span id="cb10-250"><a href="#cb10-250"></a></span>
<span id="cb10-251"><a href="#cb10-251"></a><span class="in">```</span></span>
<span id="cb10-252"><a href="#cb10-252"></a><span class="in"> {</span></span>
<span id="cb10-253"><a href="#cb10-253"></a><span class="in">      "bands" : {</span></span>
<span id="cb10-254"><a href="#cb10-254"></a><span class="in">          "red" : {</span></span>
<span id="cb10-255"><a href="#cb10-255"></a><span class="in">              "nodata" : 0,</span></span>
<span id="cb10-256"><a href="#cb10-256"></a><span class="in">              "pattern" : ".+_AnalyticMS_SR\\.tif$",</span></span>
<span id="cb10-257"><a href="#cb10-257"></a><span class="in">              "band" : 3},</span></span>
<span id="cb10-258"><a href="#cb10-258"></a><span class="in">          "green" : {</span></span>
<span id="cb10-259"><a href="#cb10-259"></a><span class="in">              "nodata" : 0,</span></span>
<span id="cb10-260"><a href="#cb10-260"></a><span class="in">              "pattern" : ".+_AnalyticMS_SR\\.tif$",</span></span>
<span id="cb10-261"><a href="#cb10-261"></a><span class="in">              "band" : 2},</span></span>
<span id="cb10-262"><a href="#cb10-262"></a><span class="in">          "blue" : {</span></span>
<span id="cb10-263"><a href="#cb10-263"></a><span class="in">              "nodata" : 0,</span></span>
<span id="cb10-264"><a href="#cb10-264"></a><span class="in">              "pattern" : ".+_AnalyticMS_SR\\.tif$",</span></span>
<span id="cb10-265"><a href="#cb10-265"></a><span class="in">              "band" : 1},</span></span>
<span id="cb10-266"><a href="#cb10-266"></a><span class="in">          "nir" : {</span></span>
<span id="cb10-267"><a href="#cb10-267"></a><span class="in">              "nodata" : 0,</span></span>
<span id="cb10-268"><a href="#cb10-268"></a><span class="in">              "pattern" : ".+_AnalyticMS_SR\\.tif$",</span></span>
<span id="cb10-269"><a href="#cb10-269"></a><span class="in">              "band" : 4},</span></span>
<span id="cb10-270"><a href="#cb10-270"></a><span class="in">          "..."</span></span>
<span id="cb10-271"><a href="#cb10-271"></a><span class="in">      }</span></span>
<span id="cb10-272"><a href="#cb10-272"></a><span class="in"> }</span></span>
<span id="cb10-273"><a href="#cb10-273"></a><span class="in">```</span></span>
<span id="cb10-274"><a href="#cb10-274"></a></span>
<span id="cb10-275"><a href="#cb10-275"></a><span class="fu">### Reading GDAL subdatasets</span></span>
<span id="cb10-276"><a href="#cb10-276"></a></span>
<span id="cb10-277"><a href="#cb10-277"></a>For some data products (such as MODIS), bands are distributed as GDAL subdatasets within a single file (typically NetCDF or HDF). Adding <span class="in">`"subdatasets" : true`</span> to the top-level JSON object</span>
<span id="cb10-278"><a href="#cb10-278"></a>makes sure that all subdatasets will be considered automatically. Other patterns of the collection format to extract image names amd date/time then relate to subdataset identifiers.</span>
<span id="cb10-279"><a href="#cb10-279"></a></span>
<span id="cb10-280"><a href="#cb10-280"></a></span>
<span id="cb10-281"><a href="#cb10-281"></a></span>
<span id="cb10-282"><a href="#cb10-282"></a><span class="fu">### Defining a global spatial reference system</span></span>
<span id="cb10-283"><a href="#cb10-283"></a></span>
<span id="cb10-284"><a href="#cb10-284"></a>Some global climate data products distributed as NetCDF files do not encode the SRS of images in a way that GDAL reads automatically.</span>
<span id="cb10-285"><a href="#cb10-285"></a>In these cases the collection format allows to define a global spatial reference system that overwrites the reference system </span>
<span id="cb10-286"><a href="#cb10-286"></a>of individual images (if available). For example, adding <span class="in">`"srs" : "EPSG:4326"`</span> to the top-level JSON object</span>
<span id="cb10-287"><a href="#cb10-287"></a>makes sure that the WGS84 spatial reference system will be used for all images.</span>
<span id="cb10-288"><a href="#cb10-288"></a></span>
<span id="cb10-289"><a href="#cb10-289"></a></span>
<span id="cb10-290"><a href="#cb10-290"></a></span>
<span id="cb10-291"><a href="#cb10-291"></a></span>
<span id="cb10-292"><a href="#cb10-292"></a><span class="fu">### Additional image metadata</span></span>
<span id="cb10-293"><a href="#cb10-293"></a></span>
<span id="cb10-294"><a href="#cb10-294"></a>It is possible to extract further per-image metadata key value pairs from GDAL datasets. The collection format may include an optional field "image_md_fields" to list metadata keys as a JSON array of strings. When GDAL datasets are opened, GDAL tries to find the corresponding metadata keys and stores corresponding values in the image metadata table of the image collection.</span>
<span id="cb10-295"><a href="#cb10-295"></a></span>
<span id="cb10-296"><a href="#cb10-296"></a>Metadata fields may be separated by domains (see <span class="co">[</span><span class="ot">GDAL metadata model</span><span class="co">](https://gdal.org/user/raster_data_model.html#metadata)</span>). If metadata fields from a specific domain are needed, you can use <span class="in">`DOMAIN:KEY`</span>, such as <span class="in">`IMAGERY:CLOUDCOVER`</span>. The example below could be used to get some per-image quality flags from MODIS metadata.</span>
<span id="cb10-297"><a href="#cb10-297"></a></span>
<span id="cb10-298"><a href="#cb10-298"></a></span>
<span id="cb10-299"><a href="#cb10-299"></a><span class="in">```</span></span>
<span id="cb10-300"><a href="#cb10-300"></a><span class="in">{"image_md_fields" : ["PERCENTLAND", "QAPERCENTGOODQUALITY", "QAPERCENTNOTPRODUCEDCLOUD"]}</span></span>
<span id="cb10-301"><a href="#cb10-301"></a><span class="in">```</span></span>
<span id="cb10-302"><a href="#cb10-302"></a></span>
<span id="cb10-303"><a href="#cb10-303"></a>   </span>
<span id="cb10-304"><a href="#cb10-304"></a></span>
<span id="cb10-305"><a href="#cb10-305"></a><span class="fu">## Complete examples</span></span>
<span id="cb10-306"><a href="#cb10-306"></a></span>
<span id="cb10-307"><a href="#cb10-307"></a>Complete examples of image collection formats can be found in the sources. There is also a <span class="co">[</span><span class="ot">dedicated GitHub repository</span><span class="co">](https://github.com/appelmar/gdalcubes_formats/tree/master/formats)</span></span>
<span id="cb10-308"><a href="#cb10-308"></a></span>
<span id="cb10-309"><a href="#cb10-309"></a></span>
<span id="cb10-310"><a href="#cb10-310"></a></span>
<span id="cb10-311"><a href="#cb10-311"></a><span class="fu">## Notes on writing custom collection formats</span></span>
<span id="cb10-312"><a href="#cb10-312"></a></span>
<span id="cb10-313"><a href="#cb10-313"></a>When writing a collection format for new data products, please make sure </span>
<span id="cb10-314"><a href="#cb10-314"></a>to check the following notes:</span>
<span id="cb10-315"><a href="#cb10-315"></a></span>
<span id="cb10-316"><a href="#cb10-316"></a><span class="ss">- </span>If available, read the data product handbook. Most official satellite image product handbooks include a section on filenaming conventions.</span>
<span id="cb10-317"><a href="#cb10-317"></a><span class="ss">- </span>For portability of local file-based image collections, make sure that preceding directory names (e.g. "C:<span class="sc">\\</span>Users<span class="sc">\\</span>", or "/home/user/data") do not matter to successfully create image collections.  </span>
<span id="cb10-318"><a href="#cb10-318"></a><span class="ss">- </span>If possible, avoid using path separators in regular expressions or use *non-capturing alternation* ``(?:/|<span class="sc">\\</span>)`` if you have to.</span>
<span id="cb10-319"><a href="#cb10-319"></a><span class="ss">- </span>Image collections do not need to include data for all bands. It is recommended to list all possible bands of a data product in the format. For example, Landsat 8 surface reflectance products may or may not include additional precomputed spectral index bands. To be able to use these bands if available, they must be listed in the collection format.</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div></div></div></div></div>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
      &nbsp;
    </div>   
    <div class="nav-footer-center">
      <ul class="footer-items list-unstyled">
    <li class="nav-item">
 © 2023 Marius Appel
  </li>  
</ul>
    </div>
    <div class="nav-footer-right">
      &nbsp;
    </div>
  </div>
</footer>



</body></html>