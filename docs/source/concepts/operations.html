<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.0.38">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>gdalcubes – operations</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
span.underline{text-decoration: underline;}
div.column{display: inline-block; vertical-align: top; width: 50%;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<link href="../../favicon.png" rel="icon" type="image/png">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>

  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<link rel="stylesheet" href="../../styles.css">
</head>

<body class="nav-sidebar floating nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <a class="navbar-brand" href="../../index.html">
    <img src="../../source/gdalcubes_logo_mini.png" alt="">
    <span class="navbar-title">gdalcubes</span>
  </a>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../source/getstarted.html">Get started</a>
  </li>  
  <li class="nav-item">
    <a class="nav-link active" href="../../source/introduction/why.html" aria-current="page">Overview</a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../source/tutorials/index.html">Tutorials</a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../source/reference/index.html">Reference</a>
  </li>  
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-help" role="button" data-bs-toggle="dropdown" aria-expanded="false">Help</a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-help">    
        <li>
    <a class="dropdown-item" href="https://github.com/appelmar/gdalcubes_R"><i class="bi bi-github" role="img">
</i> 
 <span class="dropdown-text">Source code</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="https://github.com/appelmar/gdalcubes_R/issues"><i class="bi bi-bug" role="img">
</i> 
 <span class="dropdown-text">Report an issue</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../source/introduction/faq.html"><i class="bi bi-question-circle" role="img">
</i> 
 <span class="dropdown-text">FAQ</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item">
    <a class="nav-link" href="../../source/about.html">About</a>
  </li>  
</ul>
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/appelmar/gdalcubes_R"><i class="bi bi-github" role="img">
</i> 
 </a>
  </li>  
</ul>
              <div id="quarto-search" class="" title="Search"></div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
  <nav class="quarto-secondary-nav" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
    <div class="container-fluid d-flex justify-content-between">
      <h1 class="quarto-secondary-nav-title">(Untitled)</h1>
      <button type="button" class="quarto-btn-toggle btn" aria-label="Show secondary navigation">
        <i class="bi bi-chevron-right"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse sidebar-navigation floating overflow-auto">
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true">Overview</a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../source/introduction/why.html" class="sidebar-item-text sidebar-link">Why gdalcubes?</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../source/introduction/components.html" class="sidebar-item-text sidebar-link">Components</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../source/introduction/installation.html" class="sidebar-item-text sidebar-link">Installation</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../source/introduction/faq.html" class="sidebar-item-text sidebar-link">FAQ</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../source/introduction/license.html" class="sidebar-item-text sidebar-link">License</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../source/introduction/credits.html" class="sidebar-item-text sidebar-link">Credits</a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true">Basic concepts</a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../source/concepts/image_collections.html" class="sidebar-item-text sidebar-link">Image collections</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../source/concepts/collection_formats.html" class="sidebar-item-text sidebar-link">Image collection formats</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../source/concepts/datacubes.html" class="sidebar-item-text sidebar-link">Data cubes</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../source/concepts/operations.html" class="sidebar-item-text sidebar-link active">Data cube operations</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../source/concepts/execution.html" class="sidebar-item-text sidebar-link">Execution and parallelization</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../source/concepts/udfs.html" class="sidebar-item-text sidebar-link">User-defined functions (UDFs)</a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#data-cube-operations" id="toc-data-cube-operations" class="nav-link active" data-scroll-target="#data-cube-operations">Data cube operations</a>
  <ul class="collapse">
  <li><a href="#built-in-operations" id="toc-built-in-operations" class="nav-link" data-scroll-target="#built-in-operations">Built-in operations</a></li>
  <li><a href="#chaining-of-operations" id="toc-chaining-of-operations" class="nav-link" data-scroll-target="#chaining-of-operations">Chaining of operations</a></li>
  <li><a href="#examples" id="toc-examples" class="nav-link" data-scroll-target="#examples">Examples</a></li>
  <li><a href="#export" id="toc-export" class="nav-link" data-scroll-target="#export">Data cube export</a>
  <ul class="collapse">
  <li><a href="#netcdf-export" id="toc-netcdf-export" class="nav-link" data-scroll-target="#netcdf-export">NetCDF export</a></li>
  <li><a href="#geotiff-export" id="toc-geotiff-export" class="nav-link" data-scroll-target="#geotiff-export">GeoTIFF export</a></li>
  <li><a href="#packing-data-values" id="toc-packing-data-values" class="nav-link" data-scroll-target="#packing-data-values">Packing data values</a></li>
  </ul></li>
  <li><a href="#savejson" id="toc-savejson" class="nav-link" data-scroll-target="#savejson">Saving virtual data cubes as JSON files</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">



<section id="data-cube-operations" class="level1">
<h1>Data cube operations</h1>
<p>gdalcubes includes some built-in functions to process data cubes. The table below lists available operations that take one (or more) data cube(s) and produce a derived data cube as output. Depending on the operation and their parameters, the output data cube may have different shape.</p>
<section id="built-in-operations" class="level2">
<h2 class="anchored" data-anchor-id="built-in-operations">Built-in operations</h2>
<div id="tbl-operations" class="anchored">
<table class="table">
<caption>Table 1: Built-in data cube operations</caption>
<colgroup>
<col style="width: 20%">
<col style="width: 80%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">Operation</th>
<th style="text-align: left;">Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;"><code>aggregate_space</code></td>
<td style="text-align: left;">Reduce spatial resolution of a cube by applying a spatial aggregation function.</td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>aggregate_time</code></td>
<td style="text-align: left;">Aggregate and/or regularize time series.</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><code>apply_pixel</code></td>
<td style="text-align: left;">Apply an arithmetic expression to all data cube pixels.</td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>crop</code></td>
<td style="text-align: left;">Extract a rectangular spatial / temporal / spatiotemporal window.</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><code>fill_time</code></td>
<td style="text-align: left;">Fill missing values of a data cube by simple time series interpolation.</td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>filter_geom</code></td>
<td style="text-align: left;">Filter pixels by a a spatial polygon.</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><code>filter_pixel</code></td>
<td style="text-align: left;">Filter pixels by a logical expressions on band values.</td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>join_bands</code></td>
<td style="text-align: left;">Combine bands of two identically shaped data cubes.</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><code>reduce_space</code></td>
<td style="text-align: left;">Apply a reducer function to all spatial slices of a data cube.</td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>reduce_time</code></td>
<td style="text-align: left;">Apply a reducer function to all pixel time series.</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><code>select_bands</code></td>
<td style="text-align: left;">Select specific bands of a data cube.</td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>select_time</code></td>
<td style="text-align: left;">Select irregular time slices of a data cube.</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><code>slice_space</code></td>
<td style="text-align: left;">Select a single time series of a data cube.</td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>slice_time</code></td>
<td style="text-align: left;">Select a single time slice of a data cube.</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><code>window_time</code></td>
<td style="text-align: left;">Apply a moving window aggregate or convolution kernel to all pixel time series.</td>
</tr>
</tbody>
</table>
</div>
<p>Notice that results of these operations are still data cubes. There are other functions, e.g, extracting irregular points from data cubes / or computing zonal statistics resulting in a different output type (see <a href="../../source/reference/index.html">Reference</a>).</p>
<p>Creating data cubes and calling operations on data cubes is very fast, because no image data is read and actual computations are delayed. Instead, operations return a <em>proxy</em> object or a <em>virtual</em> data cube without running any expensive computations on the data (see <a href="../../source/concepts/execution.html">Execution</a>).</p>
</section>
<section id="chaining-of-operations" class="level2">
<h2 class="anchored" data-anchor-id="chaining-of-operations">Chaining of operations</h2>
<p>Operations can be chained and still simply produce proxy objects without any expensive computations involved. Chained processes produce a <em>process graph</em> that simply memorizes what operations need to be executed and where the data comes from. Actual computations are delayed until users call a method that reads data of the resulting data cube (such as plotting, or exporting a data cube as a file, see <a href="#export">Data cube export</a>). Below, you can find some examples how data cube operations can be chained programmatically.</p>
</section>
<section id="examples" class="level2">
<h2 class="anchored" data-anchor-id="examples">Examples</h2>
<p>In R, chaining operations can be written nicely using the pipe symbol <code>|&gt;</code> (or <code>%&gt;%</code> from the <a href="https://cran.r-project.org/package=magrittr"><code>magrittr</code> package</a>), as used in the following examples.</p>
<section id="median-ndvi-over-time-series" class="level4">
<h4 class="anchored" data-anchor-id="median-ndvi-over-time-series">Median NDVI over time series</h4>
<div class="sourceCode" id="cb1"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1"></a>col <span class="ot">=</span> <span class="fu">image_collection</span>(<span class="st">"/path/to/collection.db"</span>)</span>
<span id="cb1-2"><a href="#cb1-2"></a>v <span class="ot">=</span> <span class="fu">cube_view</span>(<span class="at">srs =</span> <span class="st">"EPSG:4326"</span>, <span class="at">extent =</span> col, <span class="at">dx =</span> <span class="fl">0.01</span>, <span class="at">dy =</span> <span class="fl">0.01</span>, <span class="at">dt =</span> <span class="st">"P5D"</span>)</span>
<span id="cb1-3"><a href="#cb1-3"></a>                        </span>
<span id="cb1-4"><a href="#cb1-4"></a><span class="fu">raster_cube</span>(col, v) <span class="sc">|&gt;</span></span>
<span id="cb1-5"><a href="#cb1-5"></a> <span class="fu">select_bands</span>(<span class="fu">c</span>(<span class="st">"B04"</span>, <span class="st">"B08"</span>)) <span class="sc">|&gt;</span></span>
<span id="cb1-6"><a href="#cb1-6"></a> <span class="fu">apply_pixel</span>(<span class="st">"(B08-B04)/(B08+B04)"</span>,<span class="st">"NDVI"</span>) <span class="sc">|&gt;</span></span>
<span id="cb1-7"><a href="#cb1-7"></a> <span class="fu">reduce_time</span>(<span class="st">"median(NDVI)"</span>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="simple-rgb-composite-for-a-polygon" class="level4">
<h4 class="anchored" data-anchor-id="simple-rgb-composite-for-a-polygon">Simple RGB composite for a polygon</h4>
<div class="sourceCode" id="cb2"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1"></a>col <span class="ot">=</span> <span class="fu">image_collection</span>(<span class="st">"/path/to/collection.db"</span>)</span>
<span id="cb2-2"><a href="#cb2-2"></a>v <span class="ot">=</span> <span class="fu">cube_view</span>(<span class="at">srs =</span> <span class="st">"EPSG:4326"</span>, <span class="at">extent =</span> col, <span class="at">dx =</span> <span class="fl">0.01</span>, <span class="at">dy =</span> <span class="fl">0.01</span>, <span class="at">dt =</span> <span class="st">"P5D"</span>)</span>
<span id="cb2-3"><a href="#cb2-3"></a>                        </span>
<span id="cb2-4"><a href="#cb2-4"></a><span class="fu">raster_cube</span>(col, v) <span class="sc">|&gt;</span></span>
<span id="cb2-5"><a href="#cb2-5"></a> <span class="fu">select_bands</span>(<span class="fu">c</span>(<span class="st">"B02"</span>, <span class="st">"B03"</span>, <span class="st">"B04"</span>)) <span class="sc">|&gt;</span></span>
<span id="cb2-6"><a href="#cb2-6"></a> <span class="fu">filter_geom</span>(sf<span class="sc">::</span><span class="fu">read_sf</span>(<span class="st">"polygon_geometry.gpkg"</span>)<span class="sc">$</span>geometry) <span class="sc">|&gt;</span></span>
<span id="cb2-7"><a href="#cb2-7"></a> <span class="fu">reduce_time</span>(<span class="fu">c</span>(<span class="st">"median(B02)"</span>, <span class="st">"median(B03)"</span>, <span class="st">"median(B04)"</span>)  </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="count-large-ndvi-values-within-a-forest-area" class="level4">
<h4 class="anchored" data-anchor-id="count-large-ndvi-values-within-a-forest-area">Count large NDVI values within a forest area</h4>
<div class="sourceCode" id="cb3"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1"></a>col <span class="ot">=</span> <span class="fu">image_collection</span>(<span class="st">"/path/to/collection.db"</span>)</span>
<span id="cb3-2"><a href="#cb3-2"></a>v <span class="ot">=</span> <span class="fu">cube_view</span>(<span class="at">srs =</span> <span class="st">"EPSG:4326"</span>, <span class="at">extent =</span> col, <span class="at">dx =</span> <span class="fl">0.01</span>, <span class="at">dy =</span> <span class="fl">0.01</span>, <span class="at">dt =</span> <span class="st">"P5D"</span>)</span>
<span id="cb3-3"><a href="#cb3-3"></a>                        </span>
<span id="cb3-4"><a href="#cb3-4"></a><span class="fu">raster_cube</span>(col, v) <span class="sc">|&gt;</span></span>
<span id="cb3-5"><a href="#cb3-5"></a> <span class="fu">select_bands</span>(<span class="fu">c</span>(<span class="st">"B04"</span>, <span class="st">"B08"</span>)) <span class="sc">|&gt;</span></span>
<span id="cb3-6"><a href="#cb3-6"></a> <span class="fu">apply_pixel</span>(<span class="st">"(B08-B04)/(B08+B04)"</span>,<span class="st">"NDVI"</span>) <span class="sc">|&gt;</span></span>
<span id="cb3-7"><a href="#cb3-7"></a> <span class="fu">filter_pixel</span>(<span class="st">"NDVI &gt; 0.8"</span>) <span class="sc">|&gt;</span></span>
<span id="cb3-8"><a href="#cb3-8"></a> <span class="fu">filter_geom</span>(sf<span class="sc">::</span><span class="fu">read_sf</span>(<span class="st">"forest_boundaries.gpkg"</span>)<span class="sc">$</span>geometry) <span class="sc">|&gt;</span></span>
<span id="cb3-9"><a href="#cb3-9"></a> <span class="fu">reduce_space</span>(<span class="st">"count(NDVI)"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
</section>
<section id="export" class="level2">
<h2 class="anchored" data-anchor-id="export">Data cube export</h2>
<p>Data cubes (including the output of operations, see above) can be exported as single netCDF files, or as a collection of (possibly cloud-optimized) GeoTIFF files.</p>
<section id="netcdf-export" class="level3">
<h3 class="anchored" data-anchor-id="netcdf-export">NetCDF export</h3>
<p>Produced netCDF files use the enhanced netCDF-4 data model, follow the <a href="http://cfconventions.org/cf-conventions/v1.6.0/cf-conventions.html">CF-1.6 conventions</a> and include bands of the data cube as variables. Dimensions are in the order <em>time</em>, <em>y</em>, <em>x</em> or <em>time</em>, <em>lat</em>, <em>lon</em> respectively.</p>
<p>Users can pass additional options to control properties of the resulting netCDF file:</p>
<ul>
<li><p>DEFLATE compression can be specified by integer values between 0 (no compression) and 9 (maximum compression).</p></li>
<li><p>Users can furthermore enable or disable the inclusion of boundary variables in the output netCDF file. These variables give exact upper and lower limits of dimension values (e.g.&nbsp;start and end time of a pixel).</p></li>
</ul>
</section>
<section id="geotiff-export" class="level3">
<h3 class="anchored" data-anchor-id="geotiff-export">GeoTIFF export</h3>
<p>Exporting a data cube as a collection of GeoTIFF files will produce one multiband GeoTIFF file per time slice of the data cube. Files will be named by a user defined prefix and the date/time of the slice, such as “cube_2018-01.tif”.</p>
<p>Users can pass additional options to control properties of the resulting GeoTIFF files:</p>
<ul>
<li><p>Setting <code>overviews = TRUE</code> will generate GDAL overviews (image pyramids) for the resulting files. Overview levels reduce the pixel size by powers of 2, until width and height are lower than or equal to 256. The resampling algorithm for generating overviews can be selected from what GDAL offers (see <a href="https://gdal.org/programs/gdaladdo.html#cmdoption-gdaladdo-r">here</a>, default is nearest neighbor).</p></li>
<li><p>Setting <code>COG = TRUE</code> will produce <a href="https://www.cogeo.org">cloud-optimized GeoTIFF (COG)</a> files and includes <code>overviews = TRUE</code>.</p></li>
<li><p>Additional GDAL creation options can be passed, e.g., to define LZW or DEFLATE compression (see <a href="https://gdal.org/drivers/raster/gtiff.html#creation-options">here</a>).</p></li>
</ul>
</section>
<section id="packing-data-values" class="level3">
<h3 class="anchored" data-anchor-id="packing-data-values">Packing data values</h3>
<p>Both, GeoTIFF as well as netCDF export support <em>packing data</em>, i.e.&nbsp;reducing the size of the output file(s) by conversion of double values to smaller integer types using an affine transformation of original values by an offset and scale, where values are transformed according to the formula:</p>
<p><span class="math display">\[
  \hat{x} = \frac{x - offset}{scale}
\]</span></p>
<p>By conversion to integer, packing values reduces the precision of the data. Packing in gdalcubes requires users to pass</p>
<ul>
<li>the output data type (one of <code>uint8</code> , <code>uint16</code>, <code>int16</code>, <code>uint32</code>, <code>int32</code>, <code>float32</code>).</li>
<li>scale, offset, and nodata values (unless type is <code>float32</code> ).</li>
</ul>
<p>Nodata values of data cubes will automatically converted to provided nodata values in the target data type. Individual scale, offset, and nodata values can be specified either once (applied for all bands), or individually per band. Packing to type <code>float32</code> will ignore any of the offset, scale, and nodata values but implicitly cast 8 byte doubles to 4 byte float values.</p>
</section>
</section>
<section id="savejson" class="level2">
<h2 class="anchored" data-anchor-id="savejson">Saving virtual data cubes as JSON files</h2>
<p>Data cube and image collection objects cannot be saved and restored across different R sessions using <code>save()</code> and <code>load()</code>, because they simply point to a memory address that is destroyed when the R session ends (internally they are <em>external pointers</em>). However, since the creation of objects is relatively cheap, it is possible to serialize and store the process graph as a lightweight JSON file using <code>as_json()</code> and recreate a cube from a file with <code>json_cube()</code>.</p>


<!-- -->

</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    setTimeout(function() {
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  const viewSource = window.document.getElementById('quarto-view-source') ||
                     window.document.getElementById('quarto-code-tools-source');
  if (viewSource) {
    const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
    viewSource.addEventListener("click", function(e) {
      if (sourceUrl) {
        // rstudio viewer pane
        if (/\bcapabilities=\b/.test(window.location)) {
          window.open(sourceUrl);
        } else {
          window.location.href = sourceUrl;
        }
      } else {
        const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
        modal.show();
      }
      return false;
    });
  }
  function toggleCodeHandler(show) {
    return function(e) {
      const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
      for (let i=0; i<detailsSrc.length; i++) {
        const details = detailsSrc[i].parentElement;
        if (show) {
          details.open = true;
        } else {
          details.removeAttribute("open");
        }
      }
      const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
      const fromCls = show ? "hidden" : "unhidden";
      const toCls = show ? "unhidden" : "hidden";
      for (let i=0; i<cellCodeDivs.length; i++) {
        const codeDiv = cellCodeDivs[i];
        if (codeDiv.classList.contains(fromCls)) {
          codeDiv.classList.remove(fromCls);
          codeDiv.classList.add(toCls);
        } 
      }
      return false;
    }
  }
  const hideAllCode = window.document.getElementById("quarto-hide-all-code");
  if (hideAllCode) {
    hideAllCode.addEventListener("click", toggleCodeHandler(false));
  }
  const showAllCode = window.document.getElementById("quarto-show-all-code");
  if (showAllCode) {
    showAllCode.addEventListener("click", toggleCodeHandler(true));
  }
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      let href = ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const cites = ref.parentNode.getAttribute('data-cites').split(' ');
    tippyHover(ref, function() {
      var popup = window.document.createElement('div');
      cites.forEach(function(cite) {
        var citeDiv = window.document.createElement('div');
        citeDiv.classList.add('hanging-indent');
        citeDiv.classList.add('csl-entry');
        var biblioDiv = window.document.getElementById('ref-' + cite);
        if (biblioDiv) {
          citeDiv.innerHTML = biblioDiv.innerHTML;
        }
        popup.appendChild(citeDiv);
      });
      return popup.innerHTML;
    });
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
    var links = window.document.querySelectorAll('a:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
          // target, if specified
          link.setAttribute("target", "_blank");
          // default icon
          link.classList.add("external");
      }
    }
});
</script><div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="quarto-embedded-source-code-modal-label">Source Code</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="">
<div class="sourceCode" id="cb4" data-shortcodes="false"><pre class="sourceCode numberSource markdown number-lines code-with-copy"><code class="sourceCode markdown"><span id="cb4-1"><a href="#cb4-1"></a><span class="fu"># Data cube operations</span></span>
<span id="cb4-2"><a href="#cb4-2"></a></span>
<span id="cb4-3"><a href="#cb4-3"></a>gdalcubes includes some built-in functions to process data cubes. The table below lists available operations that take one (or more) data cube(s) and produce a derived data cube as output. Depending on the operation and their parameters, the output data cube may have different shape.</span>
<span id="cb4-4"><a href="#cb4-4"></a></span>
<span id="cb4-5"><a href="#cb4-5"></a></span>
<span id="cb4-6"><a href="#cb4-6"></a><span class="fu">## Built-in operations</span></span>
<span id="cb4-7"><a href="#cb4-7"></a></span>
<span id="cb4-8"><a href="#cb4-8"></a>| Operation           | Description                                                                        | </span>
<span id="cb4-9"><a href="#cb4-9"></a>|:--------------------|:-----------------------------------------------------------------------------------|    </span>
<span id="cb4-10"><a href="#cb4-10"></a>|<span class="in">`aggregate_space`</span>    | Reduce spatial resolution of a cube by applying a spatial aggregation function. |</span>
<span id="cb4-11"><a href="#cb4-11"></a>|<span class="in">`aggregate_time`</span>     | Aggregate and/or regularize time series. |</span>
<span id="cb4-12"><a href="#cb4-12"></a>|<span class="in">`apply_pixel`</span>        | Apply an arithmetic expression to all data cube pixels.    |</span>
<span id="cb4-13"><a href="#cb4-13"></a>|<span class="in">`crop`</span>               | Extract a rectangular spatial / temporal / spatiotemporal window. |</span>
<span id="cb4-14"><a href="#cb4-14"></a>|<span class="in">`fill_time`</span>          | Fill missing values of a data cube by simple time series interpolation. |</span>
<span id="cb4-15"><a href="#cb4-15"></a>|<span class="in">`filter_geom`</span>        | Filter pixels by a a spatial polygon. |</span>
<span id="cb4-16"><a href="#cb4-16"></a>|<span class="in">`filter_pixel`</span>       | Filter pixels by a logical expressions on band values. |</span>
<span id="cb4-17"><a href="#cb4-17"></a>|<span class="in">`join_bands`</span>         | Combine bands of two identically shaped data cubes. |</span>
<span id="cb4-18"><a href="#cb4-18"></a>|<span class="in">`reduce_space`</span>       | Apply a reducer function to all spatial slices of a data cube.  |</span>
<span id="cb4-19"><a href="#cb4-19"></a>|<span class="in">`reduce_time`</span>        | Apply a reducer function to all pixel time series. |</span>
<span id="cb4-20"><a href="#cb4-20"></a>|<span class="in">`select_bands`</span>       | Select specific bands of a data cube.  |</span>
<span id="cb4-21"><a href="#cb4-21"></a>|<span class="in">`select_time`</span>        | Select irregular time slices of a data cube. |</span>
<span id="cb4-22"><a href="#cb4-22"></a>|<span class="in">`slice_space`</span>        | Select a single time series of a data cube. |</span>
<span id="cb4-23"><a href="#cb4-23"></a>|<span class="in">`slice_time`</span>         | Select a single time slice of a data cube. |</span>
<span id="cb4-24"><a href="#cb4-24"></a>|<span class="in">`window_time`</span>        | Apply a moving window aggregate or convolution kernel to all pixel time series. |</span>
<span id="cb4-25"><a href="#cb4-25"></a></span>
<span id="cb4-26"><a href="#cb4-26"></a>: Built-in data cube operations {#tbl-operations}</span>
<span id="cb4-27"><a href="#cb4-27"></a></span>
<span id="cb4-28"><a href="#cb4-28"></a>Notice that results of these operations are still data cubes. There are other functions, e.g, extracting irregular points from data cubes / or computing zonal statistics resulting in a different output type (see <span class="co">[</span><span class="ot">Reference</span><span class="co">](../reference/index.qmd)</span>).</span>
<span id="cb4-29"><a href="#cb4-29"></a></span>
<span id="cb4-30"><a href="#cb4-30"></a>Creating data cubes and calling operations on data cubes is very fast, because no image data is read and actual computations are delayed.  Instead, operations return a *proxy* object or a _virtual_ data cube without running any expensive computations on the data (see <span class="co">[</span><span class="ot">Execution</span><span class="co">](execution.qmd)</span>). </span>
<span id="cb4-31"><a href="#cb4-31"></a></span>
<span id="cb4-32"><a href="#cb4-32"></a><span class="fu">## Chaining of operations</span></span>
<span id="cb4-33"><a href="#cb4-33"></a></span>
<span id="cb4-34"><a href="#cb4-34"></a>Operations can be chained and still simply produce proxy objects without any expensive computations involved. Chained processes produce a _process graph_ that simply memorizes what operations need to be executed and where the data comes from. Actual computations are delayed until users call a method that reads data of the resulting data cube (such as plotting, or exporting a data cube as a file, see <span class="co">[</span><span class="ot">Data cube export</span><span class="co">](#export)</span>). Below, you can find some examples how data cube operations can be chained programmatically.</span>
<span id="cb4-35"><a href="#cb4-35"></a></span>
<span id="cb4-36"><a href="#cb4-36"></a></span>
<span id="cb4-37"><a href="#cb4-37"></a><span class="fu">## Examples</span></span>
<span id="cb4-38"><a href="#cb4-38"></a></span>
<span id="cb4-39"><a href="#cb4-39"></a>In R, chaining operations can be written nicely using the pipe symbol <span class="in">`|&gt;`</span> (or <span class="in">`%&gt;%`</span> from the <span class="co">[</span><span class="ot">`magrittr` package</span><span class="co">](https://cran.r-project.org/package=magrittr)</span>), as used in the following examples.</span>
<span id="cb4-40"><a href="#cb4-40"></a></span>
<span id="cb4-41"><a href="#cb4-41"></a><span class="fu">#### Median NDVI over time series</span></span>
<span id="cb4-42"><a href="#cb4-42"></a></span>
<span id="cb4-43"><a href="#cb4-43"></a><span class="in">``` {.r}</span></span>
<span id="cb4-44"><a href="#cb4-44"></a>col <span class="ot">=</span> <span class="fu">image_collection</span>(<span class="st">"/path/to/collection.db"</span>)</span>
<span id="cb4-45"><a href="#cb4-45"></a>v <span class="ot">=</span> <span class="fu">cube_view</span>(<span class="at">srs =</span> <span class="st">"EPSG:4326"</span>, <span class="at">extent =</span> col, <span class="at">dx =</span> <span class="fl">0.01</span>, <span class="at">dy =</span> <span class="fl">0.01</span>, <span class="at">dt =</span> <span class="st">"P5D"</span>)</span>
<span id="cb4-46"><a href="#cb4-46"></a>                        </span>
<span id="cb4-47"><a href="#cb4-47"></a><span class="fu">raster_cube</span>(col, v) <span class="sc">|&gt;</span></span>
<span id="cb4-48"><a href="#cb4-48"></a> <span class="fu">select_bands</span>(<span class="fu">c</span>(<span class="st">"B04"</span>, <span class="st">"B08"</span>)) <span class="sc">|&gt;</span></span>
<span id="cb4-49"><a href="#cb4-49"></a> <span class="fu">apply_pixel</span>(<span class="st">"(B08-B04)/(B08+B04)"</span>,<span class="st">"NDVI"</span>) <span class="sc">|&gt;</span></span>
<span id="cb4-50"><a href="#cb4-50"></a> <span class="fu">reduce_time</span>(<span class="st">"median(NDVI)"</span>) </span>
<span id="cb4-51"><a href="#cb4-51"></a><span class="in">```</span></span>
<span id="cb4-52"><a href="#cb4-52"></a></span>
<span id="cb4-53"><a href="#cb4-53"></a><span class="fu">#### Simple RGB composite for a polygon</span></span>
<span id="cb4-54"><a href="#cb4-54"></a></span>
<span id="cb4-55"><a href="#cb4-55"></a><span class="in">``` {.r}</span></span>
<span id="cb4-56"><a href="#cb4-56"></a>col <span class="ot">=</span> <span class="fu">image_collection</span>(<span class="st">"/path/to/collection.db"</span>)</span>
<span id="cb4-57"><a href="#cb4-57"></a>v <span class="ot">=</span> <span class="fu">cube_view</span>(<span class="at">srs =</span> <span class="st">"EPSG:4326"</span>, <span class="at">extent =</span> col, <span class="at">dx =</span> <span class="fl">0.01</span>, <span class="at">dy =</span> <span class="fl">0.01</span>, <span class="at">dt =</span> <span class="st">"P5D"</span>)</span>
<span id="cb4-58"><a href="#cb4-58"></a>                        </span>
<span id="cb4-59"><a href="#cb4-59"></a><span class="fu">raster_cube</span>(col, v) <span class="sc">|&gt;</span></span>
<span id="cb4-60"><a href="#cb4-60"></a> <span class="fu">select_bands</span>(<span class="fu">c</span>(<span class="st">"B02"</span>, <span class="st">"B03"</span>, <span class="st">"B04"</span>)) <span class="sc">|&gt;</span></span>
<span id="cb4-61"><a href="#cb4-61"></a> <span class="fu">filter_geom</span>(sf<span class="sc">::</span><span class="fu">read_sf</span>(<span class="st">"polygon_geometry.gpkg"</span>)<span class="sc">$</span>geometry) <span class="sc">|&gt;</span></span>
<span id="cb4-62"><a href="#cb4-62"></a> <span class="fu">reduce_time</span>(<span class="fu">c</span>(<span class="st">"median(B02)"</span>, <span class="st">"median(B03)"</span>, <span class="st">"median(B04)"</span>)  </span>
<span id="cb4-63"><a href="#cb4-63"></a><span class="st">```</span></span>
<span id="cb4-64"><a href="#cb4-64"></a></span>
<span id="cb4-65"><a href="#cb4-65"></a><span class="at">#### Count large NDVI values within a forest area</span></span>
<span id="cb4-66"><a href="#cb4-66"></a></span>
<span id="cb4-67"><a href="#cb4-67"></a><span class="st">```</span> {.r}</span>
<span id="cb4-68"><a href="#cb4-68"></a><span class="at">col =</span> <span class="fu">image_collection</span>(<span class="st">"/path/to/collection.db"</span>)</span>
<span id="cb4-69"><a href="#cb4-69"></a><span class="at">v =</span> <span class="fu">cube_view</span>(<span class="at">srs =</span> <span class="st">"EPSG:4326"</span>, <span class="at">extent =</span> col, <span class="at">dx =</span> <span class="fl">0.01</span>, <span class="at">dy =</span> <span class="fl">0.01</span>, <span class="at">dt =</span> <span class="st">"P5D"</span>)</span>
<span id="cb4-70"><a href="#cb4-70"></a>                        </span>
<span id="cb4-71"><a href="#cb4-71"></a><span class="fu">raster_cube</span>(col, v) <span class="sc">|&gt;</span></span>
<span id="cb4-72"><a href="#cb4-72"></a> <span class="fu">select_bands</span>(<span class="fu">c</span>(<span class="st">"B04"</span>, <span class="st">"B08"</span>)) <span class="sc">|&gt;</span></span>
<span id="cb4-73"><a href="#cb4-73"></a> <span class="fu">apply_pixel</span>(<span class="st">"(B08-B04)/(B08+B04)"</span>,<span class="st">"NDVI"</span>) <span class="sc">|&gt;</span></span>
<span id="cb4-74"><a href="#cb4-74"></a> <span class="fu">filter_pixel</span>(<span class="st">"NDVI &gt; 0.8"</span>) <span class="sc">|&gt;</span></span>
<span id="cb4-75"><a href="#cb4-75"></a> <span class="fu">filter_geom</span>(sf<span class="sc">::</span><span class="fu">read_sf</span>(<span class="st">"forest_boundaries.gpkg"</span>)<span class="sc">$</span>geometry) <span class="sc">|&gt;</span></span>
<span id="cb4-76"><a href="#cb4-76"></a> <span class="fu">reduce_space</span>(<span class="st">"count(NDVI)"</span>)</span>
<span id="cb4-77"><a href="#cb4-77"></a><span class="st">```</span></span>
<span id="cb4-78"><a href="#cb4-78"></a></span>
<span id="cb4-79"><a href="#cb4-79"></a><span class="at">## Data cube export {#export}</span></span>
<span id="cb4-80"><a href="#cb4-80"></a></span>
<span id="cb4-81"><a href="#cb4-81"></a><span class="at">Data cubes (including the output of operations, see above) can be exported as single netCDF files, or as a collection of (possibly cloud-optimized) GeoTIFF files.</span></span>
<span id="cb4-82"><a href="#cb4-82"></a></span>
<span id="cb4-83"><a href="#cb4-83"></a><span class="at">### NetCDF export</span></span>
<span id="cb4-84"><a href="#cb4-84"></a></span>
<span id="cb4-85"><a href="#cb4-85"></a><span class="at">Produced netCDF files use the enhanced netCDF-4 data model, follow the [CF-1.6 conventions](http://cfconventions.org/cf-conventions/v1.6.0/cf-conventions.html) and include bands of the data cube as variables. Dimensions are in the order *time*, *y*, *x* or *time*, *lat*, *lon* respectively.</span></span>
<span id="cb4-86"><a href="#cb4-86"></a></span>
<span id="cb4-87"><a href="#cb4-87"></a><span class="at">Users can pass additional options to control properties of the resulting netCDF file:</span></span>
<span id="cb4-88"><a href="#cb4-88"></a></span>
<span id="cb4-89"><a href="#cb4-89"></a><span class="at">- DEFLATE compression can be specified by integer values between 0 (no compression) and 9 (maximum compression).</span></span>
<span id="cb4-90"><a href="#cb4-90"></a></span>
<span id="cb4-91"><a href="#cb4-91"></a><span class="at">- Users can furthermore enable or disable the inclusion of boundary variables in the output netCDF file. These variables give exact upper and lower limits of dimension values (e.g. start and end time of a pixel). </span></span>
<span id="cb4-92"><a href="#cb4-92"></a></span>
<span id="cb4-93"><a href="#cb4-93"></a></span>
<span id="cb4-94"><a href="#cb4-94"></a></span>
<span id="cb4-95"><a href="#cb4-95"></a></span>
<span id="cb4-96"><a href="#cb4-96"></a><span class="at">### GeoTIFF export</span></span>
<span id="cb4-97"><a href="#cb4-97"></a></span>
<span id="cb4-98"><a href="#cb4-98"></a><span class="at">Exporting a data cube as a collection of GeoTIFF files will produce one multiband GeoTIFF file per time slice of the data cube. Files will be named by a user defined prefix and the date/time of the slice, such as "cube_2018-01.tif". </span></span>
<span id="cb4-99"><a href="#cb4-99"></a></span>
<span id="cb4-100"><a href="#cb4-100"></a><span class="at">Users can pass additional options to control properties of the resulting GeoTIFF files:</span></span>
<span id="cb4-101"><a href="#cb4-101"></a></span>
<span id="cb4-102"><a href="#cb4-102"></a><span class="at">- Setting </span><span class="st">`</span><span class="at">overviews =</span> TRUE<span class="st">`</span><span class="at"> will generate GDAL overviews (image pyramids) for the resulting files. Overview levels reduce the pixel size by powers of 2, until width and height are lower than or equal to 256. The resampling algorithm for generating overviews can be selected from what GDAL offers (see [here](https://gdal.org/programs/gdaladdo.html#cmdoption-gdaladdo-r), default is nearest neighbor).</span></span>
<span id="cb4-103"><a href="#cb4-103"></a></span>
<span id="cb4-104"><a href="#cb4-104"></a><span class="at">- Setting </span><span class="st">`</span><span class="at">COG =</span> TRUE<span class="st">`</span><span class="at"> will produce [cloud-optimized GeoTIFF (COG)](https://www.cogeo.org) files and includes </span><span class="st">`</span><span class="at">overviews =</span> TRUE<span class="st">`</span><span class="at">. </span></span>
<span id="cb4-105"><a href="#cb4-105"></a></span>
<span id="cb4-106"><a href="#cb4-106"></a><span class="at">- Additional GDAL creation options can be passed, e.g., to define LZW or DEFLATE compression (see [here](https://gdal.org/drivers/raster/gtiff.html#creation-options)).</span></span>
<span id="cb4-107"><a href="#cb4-107"></a></span>
<span id="cb4-108"><a href="#cb4-108"></a></span>
<span id="cb4-109"><a href="#cb4-109"></a></span>
<span id="cb4-110"><a href="#cb4-110"></a><span class="at">### Packing data values</span></span>
<span id="cb4-111"><a href="#cb4-111"></a></span>
<span id="cb4-112"><a href="#cb4-112"></a><span class="at">Both, GeoTIFF as well as netCDF export support *packing data*, i.e. reducing the size of the output file(s) by conversion of double values to smaller integer types using an affine transformation of original values by an offset and scale, where values are transformed according to the formula: </span></span>
<span id="cb4-113"><a href="#cb4-113"></a></span>
<span id="cb4-114"><a href="#cb4-114"></a><span class="at">$$</span></span>
<span id="cb4-115"><a href="#cb4-115"></a><span class="at">  \hat{x} = </span><span class="sc">\f</span><span class="at">rac{x - offset}{scale} </span></span>
<span id="cb4-116"><a href="#cb4-116"></a><span class="at">$$</span></span>
<span id="cb4-117"><a href="#cb4-117"></a></span>
<span id="cb4-118"><a href="#cb4-118"></a><span class="at">By conversion to integer, packing values reduces the precision of the data. Packing in gdalcubes requires users to pass </span></span>
<span id="cb4-119"><a href="#cb4-119"></a></span>
<span id="cb4-120"><a href="#cb4-120"></a><span class="at">- the output data type (one of </span><span class="st">`</span>uint8<span class="st">`</span><span class="at"> , </span><span class="st">`</span>uint16<span class="st">`</span><span class="at">, </span><span class="st">`</span>int16<span class="st">`</span><span class="at">, </span><span class="st">`</span>uint32<span class="st">`</span><span class="at">, </span><span class="st">`</span>int32<span class="st">`</span><span class="at">, </span><span class="st">`</span>float32<span class="st">`</span><span class="at">).</span></span>
<span id="cb4-121"><a href="#cb4-121"></a><span class="at">- scale, offset, and nodata values (unless type is </span><span class="st">`</span>float32<span class="st">`</span><span class="at"> ).</span></span>
<span id="cb4-122"><a href="#cb4-122"></a></span>
<span id="cb4-123"><a href="#cb4-123"></a><span class="at">Nodata values of data cubes will automatically converted to provided nodata values in the target data type. Individual scale, offset, and nodata values </span></span>
<span id="cb4-124"><a href="#cb4-124"></a><span class="at">can be specified either once (applied for all bands), or individually per band.</span></span>
<span id="cb4-125"><a href="#cb4-125"></a><span class="at">Packing to type </span><span class="st">`</span>float32<span class="st">`</span><span class="at"> will ignore any of the offset, scale, and nodata values but implicitly cast 8 byte doubles to 4 byte float values.</span></span>
<span id="cb4-126"><a href="#cb4-126"></a></span>
<span id="cb4-127"><a href="#cb4-127"></a></span>
<span id="cb4-128"><a href="#cb4-128"></a></span>
<span id="cb4-129"><a href="#cb4-129"></a></span>
<span id="cb4-130"><a href="#cb4-130"></a></span>
<span id="cb4-131"><a href="#cb4-131"></a><span class="at">## Saving virtual data cubes as JSON files {#savejson}</span></span>
<span id="cb4-132"><a href="#cb4-132"></a></span>
<span id="cb4-133"><a href="#cb4-133"></a><span class="at">Data cube and image collection objects cannot be saved and restored across different R sessions using </span><span class="st">`</span><span class="fu">save</span>()<span class="st">`</span><span class="at"> and </span><span class="st">`</span><span class="fu">load</span>()<span class="st">`</span><span class="at">, because they simply point to a memory address that is destroyed when the R session ends (internally they are _external pointers_). </span></span>
<span id="cb4-134"><a href="#cb4-134"></a><span class="at">However, since the creation of objects is relatively cheap, it is possible to serialize and store the process graph as a lightweight JSON file using </span><span class="st">`</span><span class="fu">as_json</span>()<span class="st">`</span><span class="at"> and recreate a cube from a file with </span><span class="st">`</span><span class="fu">json_cube</span>()<span class="st">`</span><span class="at">. </span></span>
<span id="cb4-135"><a href="#cb4-135"></a></span>
<span id="cb4-136"><a href="#cb4-136"></a></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div></div></div></div></div>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
      <div class="nav-footer-center">
        <ul class="footer-items list-unstyled">
    <li class="nav-item">
 © 2022 Marius Appel
  </li>  
</ul>
      </div>
  </div>
</footer>



</body></html>